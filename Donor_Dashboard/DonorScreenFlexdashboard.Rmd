---
title: "Healthy Donor Screening, Poseida Therapeutics"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
    css: styles.css
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate) #to automatically guess the format of the date column
library(writexl)
library(corrplot)
library(Hmisc)
library(randomForest)
library(tidyverse)
library(readxl)
library(plotly)
library(ggforce)
library(ggstatsplot)
library(forcats)
library(ggpubr)
library(rstatix)
library(DataExplorer)
library(dlookr)
library(flextable)
library(prettydoc)
library(DT)
library(networkD3)
library(ggrepel)
library(ggcorrplot)
library(lares)
library(lmtest)

DonorScreenDatabase <- read_excel("DonorScreenDatabase.xlsx", sheet = "Sheet1", range = "A1:KQ425")
DonorScreenDatabase <- DonorScreenDatabase %>% 
  mutate(Source= as.factor(Source)) %>% 
  mutate(Fresh.vs.Frozen = as.factor(Fresh.vs.Frozen)) %>% 
  mutate(Type.of.Material = as.factor(Type.of.Material)) %>% 
  mutate(Material.Type = as.factor(Material.Type)) %>% 
  mutate(Date.of.Collection = as.Date(Date.of.Collection)) %>% 
  mutate(Date.of.Isolation = as.Date(Date.of.Isolation)) %>% 
  mutate(Isolation = as.factor(Isolation)) %>% 
  mutate(Date.of.Production = as.Date(Date.of.Production)) %>% 
  mutate(Production.Experiment = as.factor(Production.Experiment)) %>% 
  mutate(Production.Department = as.factor(Production.Department)) %>% 
  mutate(Date.of.InvitroAssay = as.Date(Date.of.InvitroAssay)) %>% 
  mutate(InVitro.Experiment = as.factor(InVitro.Experiment)) %>% 
  mutate(Date.of.CART.Dose = as.Date(Date.of.CART.Dose)) %>% 
  mutate(In.Vivo.Experiment = as.factor(In.Vivo.Experiment)) %>%
  mutate(Sex = as.factor(Sex)) %>% 
  mutate(Ethnicity = as.factor(Ethnicity)) %>% 
  mutate(Smoker = as.factor(Smoker)) %>% 
  mutate(Blood.Type = as.factor(Blood.Type)) %>% 
  mutate(CMV = as.factor(CMV)) %>% 
  mutate(HHV7.AB = as.factor(HHV7.AB)) %>% 
  mutate(HHV7.NAT = as.factor(HHV7.NAT)) %>% 
  mutate(Test.Company = as.factor(Test.Company)) %>%
  mutate(Magnesium = as.numeric(Magnesium)) %>% 
  mutate(Nucleofector.Used = as.factor(Nucleofector.Used)) %>% 
  mutate(Nucleofector.Type = as.factor(Nucleofector.Type)) %>% 
  mutate(Culture.Vessel = as.factor(Culture.Vessel)) %>% 
  mutate(CAR.Target = as.factor(CAR.Target)) %>% 
  mutate(CAR.Binder = as.factor(CAR.Binder)) %>% 
  mutate(Booster = as.factor(Booster)) %>% 
  mutate(SPB.version = as.factor(SPB.version)) %>% 
  mutate(Media.Lot = as.factor(Media.Lot)) %>% 
  mutate(Activator.Lot = as.factor(Activator.Lot)) %>% 
  mutate(Harvest.Day = as.factor(Harvest.Day)) %>% 
  mutate(CAR.Binder = as.factor(CAR.Binder)) %>% 
  mutate(Mouse.Model = as.factor(Mouse.Model)) %>% 
  mutate(PSI.Isoplexis = as.numeric(PSI.Isoplexis)) %>%
  mutate(Magnesium = as.numeric(Magnesium)) %>% 
  mutate(Expander.Status = ifelse(Harvest.FoldExpansion >= 3, "Expander", "Non-Expander")) %>%
  mutate(Expander.Status = as.factor(Expander.Status)) %>% 
  mutate(Tumor.Controller = case_when(
    Expander.Status == "Non-Expander" ~ "No invivo study",
    Expander.Status == "Expander" & TV.2.5e6.Dose <= 60 ~ "Tumor Controller",
    Expander.Status == "Expander" & TV.2.5e6.Dose > 60 & is.na(TV.5e6.Dose) ~ "To be Redosed",
    Expander.Status == "Expander" & TV.2.5e6.Dose > 60 & TV.5e6.Dose <= 60 ~ "Tumor Controller",
    Expander.Status == "Expander" & TV.2.5e6.Dose > 60 & TV.5e6.Dose > 60 ~ "No Tumor Control",
    Expander.Status == "Expander" & is.na(TV.2.5e6.Dose) & TV.5e6.Dose <= 60 ~ "Tumor Controller",
    Expander.Status == "Expander" & is.na(TV.2.5e6.Dose) & TV.5e6.Dose > 60 ~ "No Tumor Control",
    is.na(TV.5e6.Dose) & is.na(TV.2.5e6.Dose) & Expander.Status == "Expander" ~ "To be Dosed")) %>% 
  mutate(Tumor.Controller = as.factor(Tumor.Controller)) %>% 
  mutate(Source = case_when(Ethnicity == "HemaCare" ~ "Hemacare",
                            TRUE ~ Source)) %>% 
  mutate(Source = as.factor(Source)) %>% 
  mutate(Preferred.Donor = case_when(
    Tumor.Controller == "Tumor Controller" ~ "Validated Donor",
    Tumor.Controller == "To be Dosed" ~ "TBD",
    Tumor.Controller == "To be Redosed" ~ "TBD",
    Tumor.Controller == "No invivo study" ~ "Not Validated",
    Tumor.Controller == "No Tumor Control" ~ "Not Validated")
  )

prod_min_date = min(DonorScreenDatabase$Date.of.Production, na.rm = TRUE)
prod_max_date = max(DonorScreenDatabase$Date.of.Production, na.rm = TRUE)  
Invivo.controller.2024 <- DonorScreenDatabase %>% 
  filter(year(Date.of.CART.Dose) == 2024)
Invivo.controller.2023 <- DonorScreenDatabase %>% 
  filter(year(Date.of.CART.Dose) == 2023)

expansion_dataset <- DonorScreenDatabase %>% 
  select(Donor, Lot.number, Day.0.Tcells.per.well, Day.5.FoldExpansion, Harvest.FoldExpansion) %>% 
  mutate(Day.0.FoldExpansion = Day.0.Tcells.per.well / Day.0.Tcells.per.well) %>% 
  pivot_longer(cols = c(Day.0.FoldExpansion, Day.5.FoldExpansion, Harvest.FoldExpansion),
               names_to = "Day",
               values_to = "Fold Expansion")

Dashboard.Dates <- DonorScreenDatabase %>%
  mutate(collection.year = year(Date.of.Collection),
         collection.month = format(Date.of.Collection, "%b"),
         isolation.year = year(Date.of.Isolation),
         isolation.month = format(Date.of.Isolation, "%b"),
         production.year = year(Date.of.Production),
         production.month = format(Date.of.Production, "%b"),
         invivo.year = year(Date.of.CART.Dose),
         invivo.month = format(Date.of.CART.Dose, "%b"))
Dashboard.Dates$collection.month <- factor(Dashboard.Dates$collection.month,
                                                    ordered = TRUE,
                                                    levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                                               "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
Dashboard.Dates$isolation.month <- factor(Dashboard.Dates$isolation.month,
                                                    ordered = TRUE,
                                                    levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                                               "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
Dashboard.Dates$production.month <- factor(Dashboard.Dates$production.month,
                                          ordered = TRUE,
                                          levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                                     "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
Dashboard.Dates$invivo.month <- factor(Dashboard.Dates$invivo.month,
                                          ordered = TRUE,
                                          levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                                     "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))

```

Overview {.sidebar}
========================================================
**Donor Screening Database**  

The Donor Screening database is a collection of data sets joined together 
using a donor's Donor number, Donor ID (Lot number), and Production experiment.  

The database consists of:  

* **Donor Basic information**
    + Sex, Age, Ethnicity, Weight/Height/BMI, Blood Type, Smoker Status
    + Viral Tests: CMV, HHV6, HHV7.AB, HHV7.NAT
    + HLA information
* **Metabolic information**
    + Glucose, eGFR, CO2, Calcium, Albumin, Globulin, Bilirubin, AST, ALT, etc.
* **Phenotyping Information**
    + Apheresis, PanT, and Post-thaw PanT
    + Purity, Memory, Activation, Exhaustion, and Traffic Markers
* **CAR-T Production Data**
    + Reagents, Nucleofectors
    + Gene Transposition/KO, Fold-Expansion Kinetics
    + Phenotyping
* **CAR-T Invitro Assays**
    + Health and Viability Assays
    + Cytotoxicity/Serial Restimulation
    + CAR Expression
    + Phenotyping (Memory, Activation/Exhaustion, Traffic Markers)
* **CAR-T Invivo Assays**
    + RPMI-8226 mouse model
    + 5e6 and 2.5e6 doses
    + Tumor Volume/Control normalized to untreated


_You put underscore in between texts to make it italicized._  
*You can also put asterisk to make it italicized.*  
**You can put double astreisk around text to make it bolded.**  
``You can put backticks around text to display it as code.``




Statistical Summary {data-orientation=rows data-navmenu="Healthy Donor Screening Dashboard" data-navmenu-icon="fa-gauge" data-icon="fa-chart-bar"}
================

2024 Summary of Donor Screening Activities

Row
-------
### 2024 Leukopak Collections
```{r}
Leukopak.collection.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.Collection) == 2024) %>% 
      summarise(count = n())
valueBox(value = Leukopak.collection.2024,
         icon = "fa-people-arrows",
         color = "#28AEDB")
```

### 2024 PanT Isolations
```{r}
PanT.isolation.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.Isolation) == 2024) %>% 
      summarise(count = n())
valueBox(value = PanT.isolation.2024,
         icon = "fa-vials",
         color = "#28AEDB")
```

### 2024 AlloBCMA CAR-T Productions
```{r}
AlloBCMA.production.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.Production) == 2024) %>% 
      summarise(count = n())
valueBox(value = AlloBCMA.production.2024,
         icon = "fa-dna",
         color = "#F79036")
```

### 2024 CAR-T Donor Expanders
```{r}
Donor.Expander.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.Production) == 2024) %>% 
      summarise(Expander.Count = sum(Expander.Status == "Expander", na.rm = TRUE))
valueBox(value = Donor.Expander.2024,
         icon = "fa-chart-line",
         color = "#F79036")
```

### 2024 CAR-T Donors Tested in-vivo
```{r}
Invivo.study.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.CART.Dose) == 2024) %>% 
      summarise(count = n())
valueBox(value = Invivo.study.2024,
         icon = "fa-syringe",
         color = "#00A860")
```

### 2024 CAR-T Donors Controlling Tumor
```{r}
Invivo.controller.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.CART.Dose) == 2024) %>% 
      summarise(InvivoController2024 = sum(Tumor.Controller == "Tumor Controller", na.rm = TRUE))
valueBox(value = Invivo.controller.2024,
         icon = "fa-prescription",
         color = "#00A860")
```

### 2024 Donor Expander Rate
```{r}
Expander.rate.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.Production) == 2024) %>% 
      summarise(Expander.Count = sum(Expander.Status == "Expander", na.rm = TRUE),
                Total.Production.Count2024 = n(),
                Expander_rate_2024 = Expander.Count / Total.Production.Count2024 * 100) %>% 
      mutate(ExpanderRate2024Display = paste(Expander.Count, "/", Total.Production.Count2024))
gauge(value = round(Expander.rate.2024$Expander_rate_2024, 1),
      min = 0, max = 100, symbol = '%',
      gaugeSectors(success = c(70, 100), warning = c(40, 69), danger = c(0, 39)))
```

### 2024 In-Vivo Control Rate
```{r}
Invivo.controller.rate.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.CART.Dose) == 2024) %>% 
      summarise(InvivoController2024 = sum(Tumor.Controller == "Tumor Controller", na.rm = TRUE),
                TotalTestedInvivo2024 = n(),
                invivocontrolrate2024 = InvivoController2024 / TotalTestedInvivo2024 * 100) %>% 
      mutate(InvivoRate2024Display = paste(InvivoController2024, "/", TotalTestedInvivo2024))
gauge(value = round(Invivo.controller.rate.2024$invivocontrolrate2024, 1),
      min = 0, max = 100, symbol = '%',
      gaugeSectors(success = c(70, 100), warning = c(40, 69), danger = c(0, 39)))

```

### 2024 Validated Donor Rate
```{r}
Invivo.controller.rate.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.CART.Dose) == 2024) %>% 
      summarise(InvivoController2024 = sum(Tumor.Controller == "Tumor Controller", na.rm = TRUE),
                TotalTestedInvivo2024 = n(),
                invivocontrolrate2024 = InvivoController2024 / TotalTestedInvivo2024 * 100)
Expander.rate.2024 <- DonorScreenDatabase %>% 
      filter(year(Date.of.Production) == 2024) %>% 
      summarise(Expander.Count = sum(Expander.Status == "Expander", na.rm = TRUE),
                Total.Production.Count2024 = n(),
                Expander_rate_2024 = Expander.Count / Total.Production.Count2024 * 100)
Validated.controller.rate.2024 <- (Invivo.controller.rate.2024$invivocontrolrate2024 * Expander.rate.2024$Expander_rate_2024)/ 100
gauge(value = Validated.controller.rate.2024,
      min = 0, max = 100, symbol = '%',
      gaugeSectors(success = c(70, 100), warning = c(40, 69), danger = c(0, 39)))

```

Row
-------------------------
### Leukopak Collections by Year
```{r}
Dashboard.collection <- Dashboard.Dates %>% 
  group_by(collection.year, collection.month) %>% 
  summarise(count = n(), .groups = 'drop') %>% 
  arrange(collection.year, collection.month) %>% 
  group_by(collection.year) %>% 
  mutate(LKPK_cumulative = cumsum(count)) %>% 
  drop_na()
ggplotly(
  ggplot(Dashboard.collection, aes(x = collection.month, y = LKPK_cumulative, group = collection.year)) +
  geom_line(aes(color = as.factor(collection.year)), linewidth = 1) +
  geom_point(aes(color = as.factor(collection.year)), size = 3) +
  geom_label_repel(data = Dashboard.collection %>% 
                     group_by(collection.year) %>% 
                     filter(collection.month == max(collection.month)),
                   aes(label = as.factor(collection.year), color = as.factor(collection.year)),
                   vjust = 0.3, hjust = 0.5, size = 6, fill = "white", label.size = 0.5,
                   segment.color = 'grey50', box.padding = 0.5, point.padding = 0.5) +
  labs(title = "Cumulative Leukopak Collections per year",
       subtitle = "2024 Leukopak collections on track to exceed previous year",
       x = "Month",
       y = "Donors collected",
       color = "Year") +
  scale_color_manual(values = c("2019" = "#77C8A8",
                                "2020" = "#00A860",
                                "2021" = "#FDBB48",
                                "2022" = "#F79036",
                                "2023" = "#28AEDB",
                                "2024" = "#054B71")) +
  theme(plot.title = element_text(size = 10, face = "bold"),
        axis.title = element_text(size = 7.5, face = "bold"),
        axis.text = element_text(size = 7.5),
        legend.position = "right")
  )
```

### PanT Isolations by Year
```{r}
Dashboard.isolation <- Dashboard.Dates %>% 
  group_by(isolation.year, isolation.month) %>% 
  summarise(count = n(), .groups = 'drop') %>% 
  arrange(isolation.year, isolation.month) %>% 
  group_by(isolation.year) %>% 
  mutate(isolation_cumulative = cumsum(count)) %>% 
  drop_na()
ggplotly(
  ggplot(Dashboard.isolation, aes(x = isolation.month, y = isolation_cumulative, group = isolation.year)) +
  geom_line(aes(color = as.factor(isolation.year)), linewidth = 1) +
  geom_point(aes(color = as.factor(isolation.year)), size = 3) +
  geom_label_repel(data = Dashboard.isolation %>% 
               group_by(isolation.year) %>% 
               filter(isolation.month == max(isolation.month)),
             aes(label = as.factor(isolation.year), color = as.factor(isolation.year)),
             vjust = 0.3, hjust = 0.5, size = 6, fill = "white", label.size = 0.5,
             segment.color = 'grey50', box.padding = 0.5, point.padding = 0.5) +
  labs(title = "Cumulative PanT Isolations per year",
       subtitle = "2024 PanT isolations on track to exceed previous year",
       x = "Month",
       y = "Donors isolated",
       color = "Year") +
  scale_color_manual(values = c("2019" = "#77C8A8",
                                "2020" = "#00A860",
                                "2021" = "#FDBB48",
                                "2022" = "#F79036",
                                "2023" = "#28AEDB",
                                "2024" = "#054B71")) +
  theme(plot.title = element_text(size = 10, face = "bold"),
        axis.title = element_text(size = 7.5, face = "bold"),
        axis.text = element_text(size = 7.5),
        legend.position = "right")
)
```

### CAR-T Productions by Year
```{r}
Dashboard.production <- Dashboard.Dates %>% 
  group_by(production.year, production.month) %>% 
  summarise(count = n(), .groups = 'drop') %>% 
  arrange(production.year, production.month) %>% 
  group_by(production.year) %>% 
  mutate(production_cumulative = cumsum(count)) %>% 
  drop_na()
ggplotly(
  ggplot(Dashboard.production, aes(x = production.month, y = production_cumulative, group = production.year)) +
  geom_line(aes(color = as.factor(production.year)), linewidth = 1) +
  geom_point(aes(color = as.factor(production.year)), size = 3) +
  geom_label(data = Dashboard.production %>% 
               group_by(production.year) %>% 
               filter(production.month == max(production.month)),
             aes(label = as.factor(production.year), color = as.factor(production.year)),
             vjust = 0.3, hjust = 1.5, size = 6, fill = "white", label.size = 0.5) +
  labs(title = "Cumulative Donor CAR-T Productions per year",
       subtitle = "2024 CAR-T Productions on track to exceed previous year",
       x = "Month",
       y = "Donors in CAR-T Production",
       color = "Year") +
  scale_color_manual(values = c("2019" = "#77C8A8",
                                "2020" = "#00A860",
                                "2021" = "#FDBB48",
                                "2022" = "#F79036",
                                "2023" = "#28AEDB",
                                "2024" = "#054B71")) +
  theme(plot.title = element_text(size = 10, face = "bold"),
        axis.title = element_text(size = 7.5, face = "bold"),
        axis.text = element_text(size = 7.5),
        legend.position = "right")
)
```

### CAR-Ts Dosed by Year
```{r}
Dashboard.invivo <- Dashboard.Dates %>% 
  group_by(invivo.year, invivo.month) %>% 
  summarise(count = n(), .groups = 'drop') %>% 
  arrange(invivo.year, invivo.month) %>% 
  group_by(invivo.year) %>% 
  mutate(invivo_cumulative = cumsum(count)) %>% 
  drop_na()
ggplotly(
  ggplot(Dashboard.invivo, aes(x = invivo.month, y = invivo_cumulative, group = invivo.year)) +
  geom_line(aes(color = as.factor(invivo.year)), linewidth = 1) +
  geom_point(aes(color = as.factor(invivo.year)), size = 3) +
  geom_label(data = Dashboard.invivo %>% 
              group_by(invivo.year) %>% 
              filter(invivo.month == max(invivo.month)),
            aes(label = as.factor(invivo.year), color = as.factor(invivo.year)),
            vjust = 1, hjust = 1.5, size = 6, fill = "white", label.size = 0.5) +
  labs(title = "Cumulative CAR-T Donors dosed per year",
       subtitle = "2024 CAR-T donors dosed on track to exceed previous year",
       x = "Month",
       y = "CAR-T Donors Dosed",
       color = "Year") +
  scale_color_manual(values = c("2019" = "#77C8A8",
                                "2020" = "#00A860",
                                "2021" = "#FDBB48",
                                "2022" = "#F79036",
                                "2023" = "#28AEDB",
                                "2024" = "#054B71")) +
  theme(plot.title = element_text(size = 10, face = "bold"),
        axis.title = element_text(size = 7.5, face = "bold"),
        axis.text = element_text(size = 7.5),
        legend.position = "right")
)
  
```

### Sankey Diagrams {.tabset .tabset-fade data-width=800}
------------------------------------
### 2024
```{r}
sankey2024 <- DonorScreenDatabase %>%
  filter(year(Date.of.Collection) == 2024 |
           year(Date.of.Isolation) == 2024 |
           year(Date.of.Production) == 2024 |
           year(Date.of.CART.Dose) == 2024) %>% 
  select(Source, Isolation,
         Expander.Status, Tumor.Controller, Preferred.Donor) %>% 
  na.omit()
sankeylinks2024 <- sankey2024 %>% 
  mutate(row = row_number()) %>% 
  pivot_longer(cols = -row, names_to = "column", values_to = "source") %>%
  mutate(column = match(column, names(sankey2024))) %>% 
  group_by(row) %>%
  mutate(target = lead(source, order_by = column)) %>%
  filter(!is.na(target)) %>% 
  ungroup()
sankeynodes2024 <- data.frame(name = unique(c(sankeylinks2024$source, sankeylinks2024$target)))
sankeylinks2024$source_id <- match(sankeylinks2024$source, sankeynodes2024$name) - 1
sankeylinks2024$target_id <- match(sankeylinks2024$target, sankeynodes2024$name) - 1
sankeylinks2024$value <- 1
sankey.colors2024 <- 'd3.scaleOrdinal() .domain(["OBI", "AllCells", "Prodigy", "Expander", "Non-Expander", "To be Dosed", "To be Redosed", "Tumor Controller", "No invivo study", "TBD", "Validated Donor", "Not Validated"]) 
                                   .range(["#2A629A", "#003285", "#C738BD", "#059212", "#FF6969",         "#FEAE6F",      "FEAE6F",        "#06D001", "#FF7F3E", "#686D76", "#06D001", "#C80036"])'
sankeydiagram2024 <- sankeyNetwork(Links = as.data.frame(sankeylinks2024),
                                   Nodes = sankeynodes2024,
                                   Source = "source_id",
                                   Target = "target_id",
                                   Value = "value",
                                   NodeID = "name",
                                   nodeWidth = 30,
                                   nodePadding = 50,
                                   fontSize = 20,
                                   width = 1500,
                                   colourScale = sankey.colors2024,
                                   sinksRight = TRUE)
sankeydiagram2024
```

### 2023
```{r}
sankey2023 <- DonorScreenDatabase %>%
      filter(year(Date.of.Collection) == 2023 |
               year(Date.of.Isolation) == 2023 |
               year(Date.of.Production) == 2023 |
               year(Date.of.CART.Dose) == 2023) %>% 
      select(Source, Isolation,
             Expander.Status, Tumor.Controller, Preferred.Donor) %>% 
      na.omit()
    sankeylinks2023 <- sankey2023 %>% 
      mutate(row = row_number()) %>% 
      pivot_longer(cols = -row, names_to = "column", values_to = "source") %>%
      mutate(column = match(column, names(sankey2023))) %>% 
      group_by(row) %>%
      mutate(target = lead(source, order_by = column)) %>%
      filter(!is.na(target)) %>% 
      ungroup()
    sankeynodes2023 <- data.frame(name = unique(c(sankeylinks2023$source, sankeylinks2023$target)))
    sankeylinks2023$source_id <- match(sankeylinks2023$source, sankeynodes2023$name) - 1
    sankeylinks2023$target_id <- match(sankeylinks2023$target, sankeynodes2023$name) - 1
    sankeylinks2023$value <- 1
    sankey.colors2023 <- 'd3.scaleOrdinal() .domain(["OBI", "AllCells", "Prodigy", "Expander", "Non-Expander", "To be Dosed", "To be Redosed", "Tumor Controller", "No invivo study", "TBD", "Validated Donor", "Not Validated"]) 
                                   .range(["#2A629A", "#003285", "#C738BD", "#059212", "#FF6969",         "#FEAE6F",      "FEAE6F",        "#06D001", "#FF7F3E", "#686D76", "#06D001", "#C80036"])'
    sankeydiagram2023 <- sankeyNetwork(Links = as.data.frame(sankeylinks2023),
                                       Nodes = sankeynodes2023,
                                       Source = "source_id",
                                       Target = "target_id",
                                       Value = "value",
                                       NodeID = "name",
                                       nodeWidth = 30,
                                       nodePadding = 50,
                                       fontSize = 20,
                                       width = 1500,
                                       colourScale = sankey.colors2023,
                                       sinksRight = TRUE)
    sankeydiagram2023
```

### 2022
```{r}
sankey2022 <- DonorScreenDatabase %>%
      filter(year(Date.of.Collection) == 2022 |
               year(Date.of.Isolation) == 2022 |
               year(Date.of.Production) == 2022 |
               year(Date.of.CART.Dose) == 2022) %>% 
      select(Source, Isolation,
             Expander.Status, Tumor.Controller, Preferred.Donor) %>% 
      na.omit()
    sankeylinks2022 <- sankey2022 %>% 
      mutate(row = row_number()) %>% 
      pivot_longer(cols = -row, names_to = "column", values_to = "source") %>%
      mutate(column = match(column, names(sankey2022))) %>% 
      group_by(row) %>%
      mutate(target = lead(source, order_by = column)) %>%
      filter(!is.na(target)) %>% 
      ungroup()
    sankeynodes2022 <- data.frame(name = unique(c(sankeylinks2022$source, sankeylinks2022$target)))
    sankeylinks2022$source_id <- match(sankeylinks2022$source, sankeynodes2022$name) - 1
    sankeylinks2022$target_id <- match(sankeylinks2022$target, sankeynodes2022$name) - 1
    sankeylinks2022$value <- 1
    sankey.colors2022 <- 'd3.scaleOrdinal() .domain(["OBI", "AllCells", "Prodigy", "Expander", "Non-Expander", "To be Dosed", "To be Redosed", "Tumor Controller", "No invivo study", "TBD", "Validated Donor", "Not Validated"]) 
                                   .range(["#2A629A", "#003285", "#C738BD", "#059212", "#FF6969",         "#FEAE6F",      "FEAE6F",        "#06D001", "#FF7F3E", "#686D76", "#06D001", "#C80036"])'
    sankeydiagram2022 <- sankeyNetwork(Links = as.data.frame(sankeylinks2022),
                                       Nodes = sankeynodes2022,
                                       Source = "source_id",
                                       Target = "target_id",
                                       Value = "value",
                                       NodeID = "name",
                                       nodeWidth = 30,
                                       nodePadding = 50,
                                       fontSize = 20,
                                       width = 1500,
                                       colourScale = sankey.colors2022,
                                       sinksRight = TRUE)
    sankeydiagram2022
```

Donor Screening Database Table {data-orientation=rows data-navmenu="Healthy Donor Screening Dashboard" data-navmenu-icon="fa-gauge" data-icon="fa-solid fa-table"}
==============================================

Rows
------------------------------------------
### Donor Screening Database {data-height=1000}
```{r}
DTDonorInfo <- DonorScreenDatabase %>% 
        select(Donor, Lot.number, Source, Date.of.Isolation, Date.of.Production, Harvest.FoldExpansion, Tumor.Control.5e6.Dose, Tumor.Control.2.5e6.Dose, Preferred.Donor) %>%
        mutate(Harvest.FoldExpansion = round(Harvest.FoldExpansion, 1)) %>%
        mutate(Tumor.Control.5e6.Dose = round(Tumor.Control.5e6.Dose, 1)) %>%
        mutate(Tumor.Control.2.5e6.Dose = round(Tumor.Control.2.5e6.Dose, 1)) %>% 
        datatable(
          filter = list(
            position = "top", clear = FALSE),
          options = list(
            pageLength = 50,
            columnDefs = list(list(className = "dt_center", targets = "_all")),
            scrollX = TRUE),
          class = c("compact", "hover", "cell-border", "nowrap", "stripe"),
          caption = "Harvest Fold-Expansion and Tumor Controls Determine Healthy Validated Donor."
        )
      DTDonorInfo
```


Production Fold-Expansion {data-orientation=columns data-navmenu="Manufacturability Correlations" data-navmenu-icon="fa-chart-line" data-icon="fa-person-walking"}
==========================================================================

Column {data-width=250}
--------------------------------------------------------------------
### Production Fold-Expansion Distribution
```{r}
Expansion.Histogram <- DonorScreenDatabase %>% 
  filter(!is.na(Harvest.FoldExpansion))


expansion_median <- median(Expansion.Histogram$Harvest.FoldExpansion)
expansion_mean <- mean(Expansion.Histogram$Harvest.FoldExpansion)
Expansion.normality <- shapiro.test(Expansion.Histogram$Harvest.FoldExpansion)

ggplotly(ggplot(data = Expansion.Histogram, aes(x=Harvest.FoldExpansion)) +
           geom_histogram(fill="#FCD792", color="black") +
           geom_vline(xintercept = expansion_median, color="#054B71", linetype="dashed", size=1) +
           annotate(geom="text", x=5, y=20, color="#054B71", size = 2.5,
                    label=paste("Expansion\nMedian =", round(expansion_median, 1))) +
           geom_vline(xintercept = expansion_mean, color="#0086BD", linetype = "dashed", size=1) +
           annotate(geom="text", x=10, y=20, color="#0086BD", size=2.5,
                    label=paste("Expansion\nMean =", round(expansion_mean, 1))) +
           annotate(geom = "text", x=17.5, y=15, size=2.5,
                    label=paste("Shapiro-Wilk\nNormality Test =", round(Expansion.normality$p.value, 6))) +
           labs(x="Production Fold-Expansion", y="Frequency", 
           title="Production-Fold Expansion distribution\nis not normally distributed") +
  theme(axis.title.x = element_text(size=10, face="bold"),
        axis.title.y = element_text(size=10, face="bold"),
        axis.text.x = element_text(size=10),
        axis.text.y = element_text(size=10),
        plot.title = element_text(size=10, face="bold")))
```


Column {.tabset .tabset-fade .tabset-pills}
----------------------------------------
### Expansion Spearman Correlations
```{r}
Expansion.Spearman.Barchart <- DonorScreenDatabase %>% 
  select(19, 23:25, 55:180, Harvest.FoldExpansion, -"C Reactive Protein (mg/L)") %>% 
  mutate(across(everything(), as.numeric))
SpearmanExpansionCorrelation <- rcorr(as.matrix(Expansion.Spearman.Barchart), type = "spearman")
correlationExpansion <- SpearmanExpansionCorrelation$r["Harvest.FoldExpansion", ]
pvalueExpansion <- SpearmanExpansionCorrelation$P["Harvest.FoldExpansion", ]
SpearmanExpansionDataFrame <- data.frame(spearmans = correlationExpansion, pvalue = pvalueExpansion)
filteredSpearman <- SpearmanExpansionDataFrame %>% 
  filter(pvalue <= 0.01) %>% 
  na.omit()
ggplotly(ggplot(filteredSpearman, aes(x = spearmans, y = reorder(row.names(filteredSpearman), spearmans), fill = spearmans)) +
           geom_bar(stat = "identity", color = "black") +
           geom_text(aes(label = round(spearmans, 2)), position = position_stack(vjust = 0.5), size = 3) +
           scale_fill_gradient2(low = "#EF476F", mid = "white", high = "#0086BD", midpoint = 0, name = "Spearman Correlation") +
           labs(title = "Spearman Correlations to Expansion",
                x = "Spearman Correlation",
                y = "Variables") +
           theme(axis.text.y = element_text(size = 10),
                 axis.title.y = element_text(size=10, face="bold"),
                 plot.title = element_text(size = 10, face="bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.text.x = element_text(size=10)) +
           annotate("text", x = 0.25, y = 1.1, label = "All values p<0.01", size = 2.5, color = "red"))
```

### Expansion Pearson Correlations
```{r}
PearsonExpansionCorrelation <- rcorr(as.matrix(Expansion.Spearman.Barchart), type = "pearson")
pearsoncorrelationExpansion <- PearsonExpansionCorrelation$r["Harvest.FoldExpansion", ]
pearsonpvalueExpansion <- PearsonExpansionCorrelation$P["Harvest.FoldExpansion", ]
PearsonExpansionDataFrame <- data.frame(pearson = pearsoncorrelationExpansion, pearsonpvalue = pvalueExpansion)
filteredpearson <- PearsonExpansionDataFrame %>% 
  filter(pearsonpvalue <= 0.01) %>% 
  na.omit()
ggplotly(ggplot(filteredpearson, aes(x = pearson, y = reorder(row.names(filteredpearson), pearson), fill = pearson)) +
           geom_bar(stat = "identity", color = "black") +
           geom_text(aes(label = round(pearson, 2)), position = position_stack(vjust = 0.5), size = 3) +
           scale_fill_gradient2(low = "#EF476F", mid = "white", high = "#0086BD", midpoint = 0, name = "Pearson Correlation") +
           labs(title = "Pearson Correlations to Expansion",
                x = "Pearson Correlation",
                y = "Variables") +
           theme(axis.text.y = element_text(size = 10),
                 axis.title.y = element_text(size=10, face="bold"),
                 plot.title = element_text(size = 10, face="bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.text.x = element_text(size=10)) +
           annotate("text", x = 0.25, y = 1.1, label = "All values p<0.01", size = 2.5, color = "red"))
```

### Ranked Cross Correlation (Pearson)
```{r}
ggplotly(corr_cross(Expansion.Spearman.Barchart,
           plot = TRUE,
           pvalue = TRUE,
           max_pvalue = 0.05,
           type = 1,
           top = 20,
           grid = TRUE))
```




Column {.tabset .tabset-fade data-width=250}
---------------------------------------------
### CO2
```{r}
Expansion.CO2 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, CO2) %>% 
  na.omit()
Expansion.CO2.correlation <- cor.test(Expansion.CO2$Harvest.FoldExpansion,
                                  Expansion.CO2$CO2,
                                  method = "spearman")
Expansion.CO2.correlation.spearman <- Expansion.CO2.correlation$estimate
Expansion.CO2.correlation.pvalue <- Expansion.CO2.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = CO2, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Donor CO2 negatively correlates to Harvest-FolExpansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5)) +
           annotate("text", x = 18, y = 20,
                    label = paste("Spearman =", round(Expansion.CO2.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.CO2.correlation.pvalue)),
                    color = "blue", fontface = "bold"))




```


### Aph Tcells
```{r}
Expansion.AphCD45Tcells <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, Aph.CD45.Tcells) %>% 
  na.omit()
Expansion.AphCD45Tcells.correlation <- cor.test(Expansion.AphCD45Tcells$Harvest.FoldExpansion,
                                           Expansion.AphCD45Tcells$Aph.CD45.Tcells,
                                           method = "spearman")
Expansion.AphCD45Tcells.correlation.spearman <- Expansion.AphCD45Tcells.correlation$estimate
Expansion.AphCD45Tcells.correlation.pvalue <- Expansion.AphCD45Tcells.correlation$p.value
Expansion.AphCD45.Tcells.lm <- lm(Harvest.FoldExpansion ~ Aph.CD45.Tcells, data = Expansion.AphCD45Tcells)
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = Aph.CD45.Tcells, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to CD3+CD45+ of Apheresis") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 25, y = 15,
                    label = paste("Spearman =", round(Expansion.AphCD45Tcells.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.AphCD45Tcells.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))



```

### Aph NKcells
```{r}
Expansion.AphCD45NK <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, Aph.CD45.NKcells) %>% 
  na.omit()
Expansion.AphCD45NK.correlation <- cor.test(Expansion.AphCD45NK$Harvest.FoldExpansion,
                                          Expansion.AphCD45NK$Aph.CD45.NKcells,
                                          method = "spearman")
Expansion.AphCD45NK.correlation.spearman <- Expansion.AphCD45NK.correlation$estimate
Expansion.AphCD45NK.correlation.pvalue <- Expansion.AphCD45NK.correlation$p.value

ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = Aph.CD45.NKcells, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion negatively correlates to NKcells of Aph") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 20, y = 15,
                    label = paste("Spearman =", round(Expansion.AphCD45NK.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.AphCD45NK.correlation.pvalue)),
                    color = "blue", fontface = "italic")
) 
```

### Aph Tcells-CD4
```{r}
Expansion.AphCD4 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, Aph.CD45.Tcells.CD4) %>% 
  na.omit()
Expansion.AphCD4.correlation <- cor.test(Expansion.AphCD4$Harvest.FoldExpansion,
                                         Expansion.AphCD4$Aph.CD45.Tcells.CD4,
                                         method = "spearman")
Expansion.AphCD4.correlation.spearman <- Expansion.AphCD4.correlation$estimate
Expansion.AphCD4.correlation.pvalue <- Expansion.AphCD4.correlation$p.value

ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = Aph.CD45.Tcells.CD4, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to CD3+CD45+CD4 of Aph") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 30, y = 15,
                    label = paste("Spearman =", round(Expansion.AphCD4.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.AphCD4.correlation.pvalue)),
                    color = "blue", fontface = "italic")
) 
```

### Aph Tcells-CD8
```{r}
Expansion.AphCD8 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, Aph.CD45.Tcells.CD4) %>% 
  na.omit()
Expansion.AphCD8.correlation <- cor.test(Expansion.AphCD8$Harvest.FoldExpansion,
                                         Expansion.AphCD8$Aph.CD45.Tcells.CD4,
                                         method = "spearman")
Expansion.AphCD8.correlation.spearman <- Expansion.AphCD8.correlation$estimate
Expansion.AphCD8.correlation.pvalue <- Expansion.AphCD8.correlation$p.value

ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = Aph.CD45.Tcells.CD8, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to CD3+CD45+CD8 of Aph") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 60, y = 15,
                    label = paste("Spearman =", round(Expansion.AphCD8.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.AphCD8.correlation.pvalue)),
                    color = "blue", fontface = "italic"))
```

### PanT Tcells
```{r}
Expansion.PanTCD45Tcells <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD45.Tcells) %>% 
  na.omit()
Expansion.PanTCD45Tcells.correlation <- cor.test(Expansion.PanTCD45Tcells$Harvest.FoldExpansion,
                                            Expansion.PanTCD45Tcells$PanT.CD45.Tcells,
                                            method = "spearman")
Expansion.PanTCD45Tcells.correlation.spearman <- Expansion.PanTCD45Tcells.correlation$estimate
Expansion.PanTCD45Tcells.correlation.pvalue <- Expansion.PanTCD45Tcells.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD45.Tcells, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to CD3+CD45+ of PanTs") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 15,
                    label = paste("Spearman =", round(Expansion.PanTCD45Tcells.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD45Tcells.correlation.pvalue)),
                    color = "blue", fontface = "italic") +
           coord_cartesian(x = c(40, 100))
         ) 
```

### PanT NKcells
```{r}
Expansion.PanTCD45NK <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD45.NKcells) %>% 
  na.omit()
Expansion.PanTCD45NK.correlation <- cor.test(Expansion.PanTCD45NK$Harvest.FoldExpansion,
                                            Expansion.PanTCD45NK$PanT.CD45.NKcells,
                                            method = "spearman")
Expansion.PanTCD45NK.correlation.spearman <- Expansion.PanTCD45NK.correlation$estimate
Expansion.PanTCD45NK.correlation.pvalue <- Expansion.PanTCD45NK.correlation$p.value

ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD45.NKcells, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion negatively correlates to NKcells of PanT") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 7.5, y = 15,
                    label = paste("Spearman =", round(Expansion.PanTCD45NK.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD45NK.correlation.pvalue)),
                    color = "blue", fontface = "italic")
) 
```

### PanT Monocytes
```{r}
Expansion.PanTMonocytes <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD45.Monocytes) %>% 
  na.omit()
Expansion.PanTMonocytes.correlation <- cor.test(Expansion.PanTMonocytes$Harvest.FoldExpansion,
                                                Expansion.PanTMonocytes$PanT.CD45.Monocytes,
                                                method = "spearman")
Expansion.PanTMonocytes.correlation.spearman <- Expansion.PanTMonocytes.correlation$estimate
Expansion.PanTMonocytes.correlation.pvalue <- Expansion.PanTMonocytes.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD45.Monocytes, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion negatively correlates to PanT-Monocytes") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 5, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTMonocytes.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTMonocytes.correlation.pvalue)),
                    color = "blue", fontface = "italic"))
```

### PanT CD4-Naive
```{r}
Expansion.PanTCD4Naive <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD4.Naive) %>% 
  na.omit()
Expansion.PanTCD4Naive.correlation <- cor.test(Expansion.PanTCD4Naive$Harvest.FoldExpansion,
                                              Expansion.PanTCD4Naive$PanT.CD4.Naive,
                                              method = "spearman")
Expansion.PanTCD4Naive.correlation.spearman <- Expansion.PanTCD4Naive.correlation$estimate
Expansion.PanTCD4Naive.correlation.pvalue <- Expansion.PanTCD4Naive.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD4.Naive, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD4-Naive") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 90, y = 20,
                    label = paste("Spearman =", round(Expansion.PanTCD4Naive.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD4Naive.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD4-Naive-Tscm
```{r}
Expansion.PanTCD4NaiveTscm <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD4.Naive.Tscm) %>% 
  na.omit()
Expansion.PanTCD4NaiveTscm.correlation <- cor.test(Expansion.PanTCD4NaiveTscm$Harvest.FoldExpansion,
                                              Expansion.PanTCD4NaiveTscm$PanT.CD4.Naive.Tscm,
                                              method = "spearman")
Expansion.PanTCD4NaiveTscm.correlation.spearman <- Expansion.PanTCD4NaiveTscm.correlation$estimate
Expansion.PanTCD4NaiveTscm.correlation.pvalue <- Expansion.PanTCD4NaiveTscm.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD4.Naive.Tscm, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD4-Naive-Tscm") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 90, y = 20,
                    label = paste("Spearman =", round(Expansion.PanTCD4NaiveTscm.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD4NaiveTscm.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD4-CCR7
```{r}
Expansion.PanTCD4CCR7 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD4.CCR7) %>% 
  na.omit()
Expansion.PanTCD4CCR7.correlation <- cor.test(Expansion.PanTCD4CCR7$Harvest.FoldExpansion,
                                              Expansion.PanTCD4CCR7$PanT.CD4.CCR7,
                                              method = "spearman")
Expansion.PanTCD4CCR7.correlation.spearman <- Expansion.PanTCD4CCR7.correlation$estimate
Expansion.PanTCD4CCR7.correlation.pvalue <- Expansion.PanTCD4CCR7.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD4.CCR7, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD4-CCR7") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD4CCR7.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD4CCR7.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD4-CD62L
```{r}
Expansion.PanTCD4CD62L <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD4.CD62L) %>% 
  na.omit()
Expansion.PanTCD4CD62L.correlation <- cor.test(Expansion.PanTCD4CD62L$Harvest.FoldExpansion,
                                              Expansion.PanTCD4CD62L$PanT.CD4.CD62L,
                                              method = "spearman")
Expansion.PanTCD4CD62L.correlation.spearman <- Expansion.PanTCD4CD62L.correlation$estimate
Expansion.PanTCD4CD62L.correlation.pvalue <- Expansion.PanTCD4CD62L.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD4.CD62L, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD4-CD62L") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD4CD62L.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD4CD62L.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD4-Tem
```{r}
Expansion.PanTCD4Tem <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD4.Tem) %>% 
  na.omit()
Expansion.PanTCD4Tem.correlation <- cor.test(Expansion.PanTCD4Tem$Harvest.FoldExpansion,
                                              Expansion.PanTCD4Tem$PanT.CD4.Tem,
                                              method = "spearman")
Expansion.PanTCD4Tem.correlation.spearman <- Expansion.PanTCD4Tem.correlation$estimate
Expansion.PanTCD4Tem.correlation.pvalue <- Expansion.PanTCD4Tem.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD4.Tem, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD4-Tem") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD4Tem.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD4Tem.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD8-Naive-Tscm
```{r}
Expansion.PanTCD8NaiveTscm <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD8.Naive.Tscm) %>% 
  na.omit()
Expansion.PanTCD8NaiveTscm.correlation <- cor.test(Expansion.PanTCD8NaiveTscm$Harvest.FoldExpansion,
                                              Expansion.PanTCD8NaiveTscm$PanT.CD8.Naive.Tscm,
                                              method = "spearman")
Expansion.PanTCD8NaiveTscm.correlation.spearman <- Expansion.PanTCD8NaiveTscm.correlation$estimate
Expansion.PanTCD8NaiveTscm.correlation.pvalue <- Expansion.PanTCD8NaiveTscm.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD8.Naive.Tscm, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD8-Naive-Tscm") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 90, y = 20,
                    label = paste("Spearman =", round(Expansion.PanTCD8NaiveTscm.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD8NaiveTscm.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD8-CCR7
```{r}
Expansion.PanTCD8CCR7 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD8.CCR7) %>% 
  na.omit()
Expansion.PanTCD8CCR7.correlation <- cor.test(Expansion.PanTCD8CCR7$Harvest.FoldExpansion,
                                              Expansion.PanTCD8CCR7$PanT.CD8.CCR7,
                                              method = "spearman")
Expansion.PanTCD8CCR7.correlation.spearman <- Expansion.PanTCD8CCR7.correlation$estimate
Expansion.PanTCD8CCR7.correlation.pvalue <- Expansion.PanTCD8CCR7.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD8.CCR7, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD8-CCR7") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD8CCR7.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD8CCR7.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD8-CD62L
```{r}
Expansion.PanTCD8CD62L <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD8.CD62L) %>% 
  na.omit()
Expansion.PanTCD8CD62L.correlation <- cor.test(Expansion.PanTCD8CD62L$Harvest.FoldExpansion,
                                              Expansion.PanTCD8CD62L$PanT.CD8.CD62L,
                                              method = "spearman")
Expansion.PanTCD8CD62L.correlation.spearman <- Expansion.PanTCD8CD62L.correlation$estimate
Expansion.PanTCD8CD62L.correlation.pvalue <- Expansion.PanTCD8CD62L.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD8.CD62L, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD8-CD62L") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 90, y = 20,
                    label = paste("Spearman =", round(Expansion.PanTCD8CD62L.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD8CD62L.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD8-Tem
```{r}
Expansion.PanTCD8Tem <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD8.Tem) %>% 
  na.omit()
Expansion.PanTCD8Tem.correlation <- cor.test(Expansion.PanTCD8Tem$Harvest.FoldExpansion,
                                              Expansion.PanTCD8Tem$PanT.CD8.Tem,
                                              method = "spearman")
Expansion.PanTCD8Tem.correlation.spearman <- Expansion.PanTCD8Tem.correlation$estimate
Expansion.PanTCD8Tem.correlation.pvalue <- Expansion.PanTCD8Tem.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD8.Tem, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD8-Tem") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD8Tem.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD8Tem.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD8-Teff
```{r}
Expansion.PanTCD8Teff <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD8.Teff) %>% 
  na.omit()
Expansion.PanTCD8Teff.correlation <- cor.test(Expansion.PanTCD8Teff$Harvest.FoldExpansion,
                                              Expansion.PanTCD8Teff$PanT.CD8.Teff,
                                              method = "spearman")
Expansion.PanTCD8Teff.correlation.spearman <- Expansion.PanTCD8Teff.correlation$estimate
Expansion.PanTCD8Teff.correlation.pvalue <- Expansion.PanTCD8Teff.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD8.Teff, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD8-Teff") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD8Teff.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD8Teff.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD4-CD27
```{r}
Expansion.PanTCD4CD27 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD4.CD27) %>% 
  na.omit()
Expansion.PanTCD4CD27.correlation <- cor.test(Expansion.PanTCD4CD27$Harvest.FoldExpansion,
                                              Expansion.PanTCD4CD27$PanT.CD4.CD27,
                                              method = "spearman")
Expansion.PanTCD4CD27.correlation.spearman <- Expansion.PanTCD4CD27.correlation$estimate
Expansion.PanTCD4CD27.correlation.pvalue <- Expansion.PanTCD4CD27.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD4.CD27, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD4-CD27") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD4CD27.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD4CD27.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD4-Lag3
```{r}
Expansion.PanTCD4Lag3 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD4.Lag3) %>% 
  na.omit()
Expansion.PanTCD4Lag3.correlation <- cor.test(Expansion.PanTCD4Lag3$Harvest.FoldExpansion,
                                              Expansion.PanTCD4Lag3$PanT.CD4.Lag3,
                                              method = "spearman")
Expansion.PanTCD4Lag3.correlation.spearman <- Expansion.PanTCD4Lag3.correlation$estimate
Expansion.PanTCD4Lag3.correlation.pvalue <- Expansion.PanTCD4Lag3.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD4.Lag3, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD4-Lag3") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD4Lag3.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD4Lag3.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD4-Tim3
```{r}
Expansion.PanTCD4Tim3 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD4.Tim3) %>% 
  na.omit()
Expansion.PanTCD4Tim3.correlation <- cor.test(Expansion.PanTCD4Tim3$Harvest.FoldExpansion,
                                              Expansion.PanTCD4Tim3$PanT.CD4.Tim3,
                                              method = "spearman")
Expansion.PanTCD4Tim3.correlation.spearman <- Expansion.PanTCD4Tim3.correlation$estimate
Expansion.PanTCD4Tim3.correlation.pvalue <- Expansion.PanTCD4Tim3.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD4.Tim3, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD4-Tim3") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD4Tim3.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD4Tim3.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD8-CD25
```{r}
Expansion.PanTCD8CD25 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD8.CD25) %>% 
  na.omit()
Expansion.PanTCD8CD25.correlation <- cor.test(Expansion.PanTCD8CD25$Harvest.FoldExpansion,
                                              Expansion.PanTCD8CD25$PanT.CD8.CD25,
                                              method = "spearman")
Expansion.PanTCD8CD25.correlation.spearman <- Expansion.PanTCD8CD25.correlation$estimate
Expansion.PanTCD8CD25.correlation.pvalue <- Expansion.PanTCD8CD25.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD8.CD25, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD8-CD25") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD8CD25.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD8CD25.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT CD8-Lag3
```{r}
Expansion.PanTCD8Lag3 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.CD8.Lag3) %>% 
  na.omit()
Expansion.PanTCD8Lag3.correlation <- cor.test(Expansion.PanTCD8Lag3$Harvest.FoldExpansion,
                                              Expansion.PanTCD8Lag3$PanT.CD8.Lag3,
                                              method = "spearman")
Expansion.PanTCD8Lag3.correlation.spearman <- Expansion.PanTCD8Lag3.correlation$estimate
Expansion.PanTCD8Lag3.correlation.pvalue <- Expansion.PanTCD8Lag3.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.CD8.Lag3, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to PanT-CD8-Lag3") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTCD8Lag3.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTCD8Lag3.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PanT PostThaw CD4-CD25
```{r}
Expansion.PanTPostthawCD4CD25 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.Postthaw.CD4.CD25) %>% 
  na.omit()
Expansion.PanTPostthawCD4CD25.correlation <- cor.test(Expansion.PanTPostthawCD4CD25$Harvest.FoldExpansion,
                                              Expansion.PanTPostthawCD4CD25$PanT.Postthaw.CD4.CD25,
                                              method = "spearman")
Expansion.PanTPostthawCD4CD25.correlation.spearman <- Expansion.PanTPostthawCD4CD25.correlation$estimate
Expansion.PanTPostthawCD4CD25.correlation.pvalue <- Expansion.PanTPostthawCD4CD25.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.Postthaw.CD4.CD25, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to Post-thaw PanT-CD4-CD25") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTPostthawCD4CD25.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTPostthawCD4CD25.correlation.pvalue)),
                    color = "blue", fontface = "italic"))

```

### PanT PostThaw CD4-CXCR3
```{r}
Expansion.PanTPostthawCD4CXCR3 <- Expansion.Spearman.Barchart %>% 
  select(Harvest.FoldExpansion, PanT.Postthaw.CD4.CXCR3) %>% 
  na.omit()
Expansion.PanTPostthawCD4CXCR3.correlation <- cor.test(Expansion.PanTPostthawCD4CXCR3$Harvest.FoldExpansion,
                                              Expansion.PanTPostthawCD4CXCR3$PanT.Postthaw.CD4.CXCR3,
                                              method = "spearman")
Expansion.PanTPostthawCD4CXCR3.correlation.spearman <- Expansion.PanTPostthawCD4CXCR3.correlation$estimate
Expansion.PanTPostthawCD4CXCR3.correlation.pvalue <- Expansion.PanTPostthawCD4CXCR3.correlation$p.value
ggplotly(ggplot(data = Expansion.Spearman.Barchart, aes(x = PanT.Postthaw.CD4.CXCR3, y = Harvest.FoldExpansion)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "FoldExpansion correlates to Post-thaw PanT-CD4-CXCR3") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 50, y = 17,
                    label = paste("Spearman =", round(Expansion.PanTPostthawCD4CXCR3.correlation.spearman, 2),
                                  "\np-value =", format.pval(Expansion.PanTPostthawCD4CXCR3.correlation.pvalue)),
                    color = "blue", fontface = "italic"))
```


Categories vs Fold-Expansion {data-orientation=columns data-navmenu="Manufacturability Correlations" data-navmenu-icon="fa-chart-line" data-icon="fa-person-walking"}
==========================================================================
Column {data-width=200 data-height=1000}
------------------------------------------
This is a figure

Column {.tabset .tabset-pills .tabset-fade}
--------------------------------------
### Blood Source
```{r}
Expansion.Demographic <- DonorScreenDatabase %>%
  filter(Source != "StemCell") %>% 
  filter(Source != "HemaCare") %>% 
  filter(Source != "Access Biologicals") %>% 
  filter(Source != "OBI (repeat)") %>% 
  filter(Source != "Miltenyi") %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Source = factor(Source,
                         ordered = TRUE,
                         levels = c("AllCells", "OBI", "Hemacare", "StemExpress")))

ggplotly(ggplot(data = Expansion.Demographic, aes(x = Source, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Source), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Source), alpha = 1,color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(aes(fill = Source), alpha = 0.5, color = "black") +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "Blood Source vs Production Fold-Expansion", x = "Source", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 2) +
           scale_fill_manual(values = c("#0086BD", "#F79036", "#FDBB48", "#00A860")))
```

### Fresh vs Frozen LKPK
```{r}
Expansion.FreshFrozen <- DonorScreenDatabase %>%
  filter(Fresh.vs.Frozen != is.na(Fresh.vs.Frozen)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Fresh.vs.Frozen = factor(Fresh.vs.Frozen))

ggplotly(ggplot(data = Expansion.FreshFrozen, aes(x = Fresh.vs.Frozen, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Fresh.vs.Frozen), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Fresh.vs.Frozen), alpha = 1, color = "black",
             outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = Fresh.vs.Frozen)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "Fresh or Frozen vs Production Fold-Expansion",
                x = "Fresh.vs.Frozen", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 1) +
           scale_fill_manual(values = c("#0086BD", "#F79036")))
```

### Type of Material
```{r}
Expansion.Typeofmaterial <- DonorScreenDatabase %>%
  filter(Type.of.Material != is.na(Type.of.Material)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Booster = factor(Type.of.Material,
         ordered = TRUE))

ggplotly(ggplot(data = Expansion.Typeofmaterial, aes(x = Type.of.Material, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Type.of.Material), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Type.of.Material), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = Type.of.Material)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "Type of Material vs Production Fold-Expansion", x = "Type of Material", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 1) +
           scale_fill_manual(values = c("#0086BD", "#F79036", "#00A860")))
```

### Sex
```{r}
Expansion.Sex <- DonorScreenDatabase %>%
  filter(Sex != is.na(Sex)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Sex = factor(Sex))

ggplotly(ggplot(data = Expansion.Sex, aes(x = Sex, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Sex), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Sex), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = Sex)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "Sex vs Production Fold-Expansion", x = "Sex", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 1) +
           scale_fill_manual(values = c("#0086BD", "#F79036")))
```

### Ethnicity
```{r}
Expansion.Ethnicity <- DonorScreenDatabase %>%
  filter(Ethnicity != is.na(Ethnicity)) %>%
  filter(Ethnicity != "Asian American") %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Ethnicity = factor(Ethnicity,
         ordered = TRUE,
         levels = c("Hispanic/Latino",
                    "Asian",
                    "Native American",
                    "Other",
                    "Caucasian",
                    "MultiEthnic",
                    "African American",
                    "Hispanic")))

ggplotly(ggplot(data = Expansion.Ethnicity, aes(x = Ethnicity, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Ethnicity), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Ethnicity), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = Ethnicity)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "Ethnicity vs Production Fold-Expansion", x = "Ethnicity", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 2) +
           scale_fill_manual(values = c("#054B71", "#0086BD", "#28AEDB", "#2DBFCC", 
                                        "#F79036", "#FDBB48", "#00A860", "#77C8A8")))
```

### Smoker Status
```{r}
Expansion.Smoker <- DonorScreenDatabase %>%
  filter(Smoker != is.na(Smoker)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Smoker = factor(Smoker,
         ordered = TRUE,
         levels = c("N", "Y")))

ggplotly(ggplot(data = Expansion.Smoker, aes(x = Smoker, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Smoker), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Smoker), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = Smoker)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "Smoker Status vs Production Fold-Expansion", x = "Smoker Status", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 1) +
           scale_fill_manual(values = c("#0086BD", "#F79036")))
```

### Blood Type
```{r}
Expansion.BloodType <- DonorScreenDatabase %>%
  filter(Blood.Type != is.na(Blood.Type)) %>% 
  filter(Blood.Type != "B-") %>% 
  filter(Blood.Type != "S") %>% 
  filter(Blood.Type != "AB-") %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Blood.Type = factor(Blood.Type,
         ordered = TRUE,
         levels = c("O-", "AB+", "A+", "B+", "O+", "A-")))

ggplotly(ggplot(data = Expansion.BloodType, aes(x = Blood.Type, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Blood.Type), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Blood.Type), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = Blood.Type)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "Blood Type vs Production Fold-Expansion", x = "Blood Type", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 2) +
           scale_fill_manual(values = c("#0086BD", "#28AEDB", "#F79036", 
                                        "#FDBB48", "#00A860", "#77C8A8")))
```

### CMV Status
```{r}
Expansion.CMV <- DonorScreenDatabase %>%
  filter(CMV != is.na(CMV)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(CMV = factor(CMV,
         ordered = TRUE,
         levels = c("Y", "N")))

ggplotly(ggplot(data = Expansion.CMV, aes(x = CMV, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = CMV), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = CMV), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = CMV)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "CMV Status vs Production Fold-Expansion", x = "CMV Status", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 1) +
           scale_fill_manual(values = c("#0086BD", "#F79036")))
```

### HHV7 NAT
```{r}
Expansion.HHV7NAT <- DonorScreenDatabase %>%
  filter(HHV7.NAT != is.na(HHV7.NAT)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Booster = factor(HHV7.NAT,
         ordered = TRUE))

ggplotly(ggplot(data = Expansion.HHV7NAT, aes(x = HHV7.NAT, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = HHV7.NAT), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = HHV7.NAT), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = HHV7.NAT)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "HHV7 NAT vs Production Fold-Expansion", x = "HHV7 NAT", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 1) +
           scale_fill_manual(values = c("#0086BD", "#F79036", "#00A860")))
```

### Production Department
```{r}
Expansion.ProductionDepartment <- DonorScreenDatabase %>%
  filter(Production.Department != is.na(Production.Department)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Production.Department = factor(Production.Department))

ggplotly(ggplot(data = Expansion.ProductionDepartment, aes(x = Production.Department, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Production.Department), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Production.Department), alpha = 1, color = "black",
             outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = Production.Department)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "Production Department vs Production Fold-Expansion",
                x = "Production Department", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 2) +
           scale_fill_manual(values = c("#0086BD", "#F79036", "#00A860")))
```

### Nucleofector Used
```{r}
Expansion.Nucleofector <- DonorScreenDatabase %>%
  filter(Nucleofector.Used != is.na(Nucleofector.Used)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Nucleofector.Used = factor(Nucleofector.Used,
         ordered = TRUE,
         levels = c("Edison", "Joule", "Franklin", "Volta", "Faraday")))

ggplotly(ggplot(data = Expansion.Nucleofector, aes(x = Nucleofector.Used, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Nucleofector.Used), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Nucleofector.Used), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = Nucleofector.Used)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "Nucleofector Used vs Production Fold-Expansion", x = "Nucleofector Used", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 2) +
           scale_fill_manual(values = c("#0086BD", "#28AEDB", "#F79036", 
                                        "#FDBB48", "#00A860", "#77C8A8")))
```

### CD2 Booster
```{r}
Expansion.Booster <- DonorScreenDatabase %>%
  filter(Booster != is.na(Booster)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(Booster = factor(Booster,
         ordered = TRUE,
         levels = c("v2", "v1", "v2 COD")))

ggplotly(ggplot(data = Expansion.Booster, aes(x = Booster, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = Booster), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = Booster), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = Booster)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "CD2 Booster vs Production Fold-Expansion", x = "Booster Version", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 2) +
           scale_fill_manual(values = c("#0086BD", "#F79036", "#00A860")))
```

### SpB Version
```{r}
Expansion.spbversion <- DonorScreenDatabase %>%
  filter(SPB.version != is.na(SPB.version)) %>% 
  arrange(Harvest.FoldExpansion) %>% 
  mutate(SPB.version = factor(SPB.version,
         ordered = TRUE))

ggplotly(ggplot(data = Expansion.spbversion, aes(x = SPB.version, y = Harvest.FoldExpansion)) +
           geom_violin(aes(fill = SPB.version), alpha = 0.25, color = "black") +
           geom_boxplot(aes(fill = SPB.version), alpha = 1, color = "black",
                        outlier.colour = "red", outlier.size = 5, outlier.shape = 8, notch = TRUE, varwidth = TRUE) +
           geom_sina(alpha = 0.5, color = "black", aes(fill = SPB.version)) +
           stat_summary(fun.data = mean_cl_boot, geom = "point", color = "black", size = 3) +
           stat_summary(fun.data = mean_cl_boot, geom = "errorbar", color = "black", size = 1, width = 0.4) +
           labs(title = "SPB version vs Production Fold-Expansion", x = "SPB version", y = "Expansion") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.text.x = element_text(size = 10, face = "bold", angle = 45, hjust = 1),
                 axis.text.y = element_text(size=10, face = "bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 legend.position = "none") +
           stat_compare_means(label.y = 25, label.x = 1) +
           scale_fill_manual(values = c("#0086BD", "#F79036", "#00A860")))
```


Column {.tabset .tabset-pills}
-------------------------------------------
### Blood Source
```{r fig.width=5}
Source.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Source, 
              data = Expansion.Demographic,
              method = "wilcox.test")
print(Source.Expansion.Wilcox)
```

### Fresh vs Frozen
```{r}
FreshFrozen.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Fresh.vs.Frozen, 
              data = Expansion.FreshFrozen,
              method = "wilcox.test")
print(FreshFrozen.Expansion.Wilcox)
```

### Type of Material
```{r}
Typeofmaterial.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Type.of.Material, 
              data = Expansion.Typeofmaterial,
              method = "wilcox.test")
print(Typeofmaterial.Expansion.Wilcox)
```

### Sex
```{r}
Sex.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Sex, 
              data = Expansion.Sex,
              method = "wilcox.test")
print(Sex.Expansion.Wilcox)
```

### Ethnicity
```{r}
Ethnicity.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Ethnicity, 
              data = Expansion.Ethnicity,
              method = "wilcox.test")
print(Ethnicity.Expansion.Wilcox)
```

### Smoker Status
```{r}
Smoker.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Smoker, 
              data = Expansion.Smoker,
              method = "wilcox.test")
print(Smoker.Expansion.Wilcox)
```

### Blood Type
```{r}
BloodType.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Blood.Type, 
              data = Expansion.BloodType,
              method = "wilcox.test")
print(BloodType.Expansion.Wilcox)
```

### CMV Status
```{r}
CMV.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ CMV, 
              data = Expansion.CMV,
              method = "wilcox.test")
print(CMV.Expansion.Wilcox)
```

### HHV7 NAT
```{r}
HHV7NAT.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ HHV7.NAT, 
              data = Expansion.HHV7NAT,
              method = "wilcox.test")
print(HHV7NAT.Expansion.Wilcox)
```

### Production Department
```{r}
ProductionDepartment.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Production.Department, 
              data = Expansion.ProductionDepartment,
              method = "wilcox.test")
print(ProductionDepartment.Expansion.Wilcox)
```

### Nucleofector Used
```{r}
Nucleofector.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Nucleofector.Used, 
              data = Expansion.Nucleofector,
              method = "wilcox.test")
print(Nucleofector.Expansion.Wilcox)
```

### CD2 Booster
```{r}
Booster.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ Booster, 
              data = Expansion.Booster,
              method = "wilcox.test")
print(Booster.Expansion.Wilcox)
```

### SPB version
```{r}
spbversion.Expansion.Wilcox <- compare_means(Harvest.FoldExpansion ~ SPB.version, 
              data = Expansion.spbversion,
              method = "wilcox.test")
print(spbversion.Expansion.Wilcox)
```


In-Vitro Assays to 5e6 Dose {data-orientation=rows data-navmenu="Tumor Control Correlations" data-navmenu-icon="fa-chart-line" data-icon="fa-person-walking"}
==========================================================================

Rows
---------------------------------
### Tumor Control at 5e6 Dose Distribution
```{r fig.width=2}
TumorControl5e6.Histogram <- DonorScreenDatabase %>% 
  filter(!is.na(Tumor.Control.5e6.Dose))
tumorcontrol5e6_median <- median(TumorControl5e6.Histogram$Tumor.Control.5e6.Dose)
tumorcontrol5e6_mean <- mean(TumorControl5e6.Histogram$Tumor.Control.5e6.Dose)
tumorcontrol5e6.normality <- shapiro.test(TumorControl5e6.Histogram$Tumor.Control.5e6.Dose)

ggplotly(ggplot(data = TumorControl5e6.Histogram, aes(x=Tumor.Control.5e6.Dose)) +
           geom_histogram(fill="#FCD792", color="black", bins = 15) +
           geom_vline(xintercept = tumorcontrol5e6_median, color="#054B71", linetype="dashed", size=1) +
           annotate(geom="text", x=50, y=60, color="#054B71", size = 2.5,
                    label=paste("TumorControl\nMedian =", round(tumorcontrol5e6_median, 1))) +
           geom_vline(xintercept = tumorcontrol5e6_mean, color="#0086BD", linetype = "dashed", size=1) +
           annotate(geom="text", x=50, y=50, color="#0086BD", size=2.5,
                    label=paste("TumorControl\nMean =", round(tumorcontrol5e6_mean, 1))) +
           annotate(geom = "text", x=15, y=40, size=2.5,
                    label=paste("Shapiro-Wilk\nNormality Test =", format.pval(tumorcontrol5e6.normality$p.value, digits = 14))) +
           labs(x="%Tumor Control at 5e6 Dose", y="Frequency", 
                title="Tumor Control at 5e6 dose\nis not normally distributed") +
           theme(axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 axis.text.x = element_text(size=10),
                 axis.text.y = element_text(size=10),
                 plot.title = element_text(size=10, face="bold")))
```

### In-vitro Assays to 5e6 dose
```{r}
InvitroSpearmansBarchart.5e6 <- DonorScreenDatabase %>% 
  select(229:292, Tumor.Control.5e6.Dose)
InvitroSpearmans <- rcorr(as.matrix(InvitroSpearmansBarchart.5e6), type = "spearman")
InvitroRho5e6 <- InvitroSpearmans$r["Tumor.Control.5e6.Dose", ]
InvitroPvalue5e6 <- InvitroSpearmans$P["Tumor.Control.5e6.Dose", ]
Invitro.Rho.Pvalue.Dataframe.5e6 <- data.frame(Rho = InvitroRho5e6, pvalue = InvitroPvalue5e6)
filtered.Rho.Pvalue.Dataframe.5e6 <- Invitro.Rho.Pvalue.Dataframe.5e6 %>% 
  filter(pvalue <= 0.01) %>% 
  na.omit()
ggplotly(ggplot(filtered.Rho.Pvalue.Dataframe.5e6, aes(x = Rho, y = reorder(row.names(filtered.Rho.Pvalue.Dataframe.5e6), Rho), fill = Rho)) +
           geom_bar(stat = "identity", color = "black") +
           geom_text(aes(label = round(Rho, 2)), position = position_stack(vjust = 0.6), size = 3) +
           scale_fill_gradient2(low = "#EF476F", mid = "white", high = "#0086BD", midpoint = 0, name = "Spearman Correlation") +
           labs(title = "Invitro Assay Spearman Correlations to Tumor Control at 5e6 dose",
                x = "Spearman Correlation",
                y = "Variables") +
           theme(axis.text.y = element_text(size = 10),
                 axis.title.y = element_text(size=10, face="bold"),
                 plot.title = element_text(size = 10, face="bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.text.x = element_text(size=10)) +
           annotate("text", x = 0.3, y = 1.1, label = "All values p<0.01", size = 5, color = "red"))
```



Rows
---------------------------------------------
### 0hrsPostthaw AV/PI
```{r}
Healthy0hrs5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Healthy.postthaw.0hrs) %>% 
  na.omit()
Healthy0hrs5e6.correlation <- cor.test(Healthy0hrs5e6$Tumor.Control.5e6.Dose,
                                        Healthy0hrs5e6$CART.Healthy.postthaw.0hrs,
                                        method = "spearman")
Healthy0hrs5e6.correlation.spearman <- Healthy0hrs5e6.correlation$estimate
Healthy0hrs5e6.correlation.pvalue <- Healthy0hrs5e6.correlation$p.value
ggplotly(ggplot(data = Healthy0hrs5e6, aes(x = CART.Healthy.postthaw.0hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose\ncorrelates to Non-Apoptotic CAR-Ts 0hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 70, y = 15,
                    label = paste("Spearman =", round(Healthy0hrs5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Healthy0hrs5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 24hrPostThaw AV/PI
```{r}
Healthy24hrs5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Healthy.postthaw.24hrs) %>% 
  na.omit()
Healthy24hrs5e6.correlation <- cor.test(Healthy24hrs5e6$Tumor.Control.5e6.Dose,
                                        Healthy24hrs5e6$CART.Healthy.postthaw.24hrs,
                                        method = "spearman")
Healthy24hrs5e6.correlation.spearman <- Healthy24hrs5e6.correlation$estimate
Healthy24hrs5e6.correlation.pvalue <- Healthy24hrs5e6.correlation$p.value
ggplotly(ggplot(data = Healthy24hrs5e6, aes(x = CART.Healthy.postthaw.24hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose\ncorrelates to Non-Apoptotic CAR-Ts 24hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 50, y = 15,
                    label = paste("Spearman =", round(Healthy24hrs5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Healthy24hrs5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))

```

### 48hrsPostthaw AV/PI
```{r}
Healthy48hrs5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Healthy.postthaw.48hrs) %>% 
  na.omit()
Healthy48hrs5e6.correlation <- cor.test(Healthy48hrs5e6$Tumor.Control.5e6.Dose,
                                        Healthy48hrs5e6$CART.Healthy.postthaw.48hrs,
                                        method = "spearman")
Healthy48hrs5e6.correlation.spearman <- Healthy48hrs5e6.correlation$estimate
Healthy48hrs5e6.correlation.pvalue <- Healthy48hrs5e6.correlation$p.value
ggplotly(ggplot(data = Healthy48hrs5e6, aes(x = CART.Healthy.postthaw.48hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose\ncorrelates to Non-Apoptotic CAR-Ts 48hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 40, y = 15,
                    label = paste("Spearman =", round(Healthy48hrs5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Healthy48hrs5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

Row
-----------------------------------------------------
### 0hrsPostthaw Luna
```{r}
Luna0hrs5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Viable.Luna.postthaw.0hrs) %>% 
  na.omit()
Luna0hrs5e6.correlation <- cor.test(Luna0hrs5e6$Tumor.Control.5e6.Dose,
                                     Luna0hrs5e6$CART.Viable.Luna.postthaw.0hrs,
                                     method = "spearman")
Luna0hrs5e6.correlation.spearman <- Luna0hrs5e6.correlation$estimate
Luna0hrs5e6.correlation.pvalue <- Luna0hrs5e6.correlation$p.value
ggplotly(ggplot(data = Luna0hrs5e6, aes(x = CART.Viable.Luna.postthaw.0hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto Luna viability 0hrs postthaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 85, y = 15,
                    label = paste("Spearman =", round(Luna0hrs5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Luna0hrs5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 24hrsPostthaw Luna
```{r}
Luna24hrs5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Viable.Luna.postthaw.24hrs) %>% 
  na.omit()
Luna24hrs5e6.correlation <- cor.test(Luna24hrs5e6$Tumor.Control.5e6.Dose,
                                     Luna24hrs5e6$CART.Viable.Luna.postthaw.24hrs,
                                     method = "spearman")
Luna24hrs5e6.correlation.spearman <- Luna24hrs5e6.correlation$estimate
Luna24hrs5e6.correlation.pvalue <- Luna24hrs5e6.correlation$p.value
ggplotly(ggplot(data = Luna24hrs5e6, aes(x = CART.Viable.Luna.postthaw.24hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto Luna viability 24hrs postthaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 60, y = 15,
                    label = paste("Spearman =", round(Luna24hrs5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Luna24hrs5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 48hrsPostthaw Luna
```{r}
Luna48hrs5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Viable.Luna.postthaw.48hrs) %>% 
  na.omit()
Luna48hrs5e6.correlation <- cor.test(Luna48hrs5e6$Tumor.Control.5e6.Dose,
                                     Luna48hrs5e6$CART.Viable.Luna.postthaw.48hrs,
                                     method = "spearman")
Luna48hrs5e6.correlation.spearman <- Luna48hrs5e6.correlation$estimate
Luna48hrs5e6.correlation.pvalue <- Luna48hrs5e6.correlation$p.value
ggplotly(ggplot(data = Luna48hrs5e6, aes(x = CART.Viable.Luna.postthaw.48hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto Luna viability 48hrs postthaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 60, y = 15,
                    label = paste("Spearman =", round(Luna48hrs5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Luna48hrs5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

Row
-----------------------------------------------
### 24hrsPostThaw NC200
```{r}
NC20024hrs5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Viable.NC200.postthaw.24hrs) %>% 
  na.omit()
NC20024hrs5e6.correlation <- cor.test(NC20024hrs5e6$Tumor.Control.5e6.Dose,
                                      NC20024hrs5e6$CART.Viable.NC200.postthaw.24hrs,
                                      method = "spearman")
NC20024hrs5e6.correlation.spearman <- NC20024hrs5e6.correlation$estimate
NC20024hrs5e6.correlation.pvalue <- NC20024hrs5e6.correlation$p.value
ggplotly(ggplot(data = NC20024hrs5e6, aes(x = CART.Viable.NC200.postthaw.24hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto NC200 viability 24hrs postthaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 85, y = 15,
                    label = paste("Spearman =", round(NC20024hrs5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(NC20024hrs5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))

```

### 48hrsPostThaw NC200
```{r}
NC20048hrs5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Viable.NC200.postthaw.48hrs) %>% 
  na.omit()
NC20048hrs5e6.correlation <- cor.test(NC20048hrs5e6$Tumor.Control.5e6.Dose,
                                      NC20048hrs5e6$CART.Viable.NC200.postthaw.48hrs,
                                      method = "spearman")
NC20048hrs5e6.correlation.spearman <- NC20048hrs5e6.correlation$estimate
NC20048hrs5e6.correlation.pvalue <- NC20048hrs5e6.correlation$p.value
ggplotly(ggplot(data = NC20048hrs5e6, aes(x = CART.Viable.NC200.postthaw.48hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto NC200 viability 48hrs postthaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 85, y = 15,
                    label = paste("Spearman =", round(NC20048hrs5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(NC20048hrs5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))

```

### 24hrsPostThaw LateApoptotic
```{r}
LateApoptotic.24hrs.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.LateApoptotic.postthaw.24hrs) %>% 
  na.omit()
LateApoptotic.24hrs.5e6.correlation <- cor.test(LateApoptotic.24hrs.5e6$Tumor.Control.5e6.Dose,
                                        LateApoptotic.24hrs.5e6$CART.LateApoptotic.postthaw.24hrs,
                                        method = "spearman")
LateApoptotic.24hrs.5e6.correlation.spearman <- LateApoptotic.24hrs.5e6.correlation$estimate
LateApoptotic.24hrs.5e6.correlation.pvalue <- LateApoptotic.24hrs.5e6.correlation$p.value
ggplotly(ggplot(data = LateApoptotic.24hrs.5e6, aes(x = CART.LateApoptotic.postthaw.24hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose\ncorrelates to CAR-T Late Apoptotic 24hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 55, y = 15,
                    label = paste("Spearman =", round(LateApoptotic.24hrs.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(LateApoptotic.24hrs.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 48hrsPostThaw LateApoptotic
```{r}
LateApoptotic.48hrs.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.LateApoptotic.postthaw.48hrs) %>% 
  na.omit()
LateApoptotic.48hrs.5e6.correlation <- cor.test(LateApoptotic.48hrs.5e6$Tumor.Control.5e6.Dose,
                                        LateApoptotic.48hrs.5e6$CART.LateApoptotic.postthaw.48hrs,
                                        method = "spearman")
LateApoptotic.48hrs.5e6.correlation.spearman <- LateApoptotic.48hrs.5e6.correlation$estimate
LateApoptotic.48hrs.5e6.correlation.pvalue <- LateApoptotic.48hrs.5e6.correlation$p.value
ggplotly(ggplot(data = LateApoptotic.48hrs.5e6, aes(x = CART.LateApoptotic.postthaw.48hrs, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose\ncorrelates to CAR-T Late Apoptotic 48hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 55, y = 15,
                    label = paste("Spearman =", round(LateApoptotic.48hrs.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(LateApoptotic.48hrs.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```


Rows
----------------------------------------
### Cytotoxicity 5:1 E:T ratio
```{r}
CARTKill5.1.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Kill.5.1.E.T) %>% 
  na.omit()
CARTKill5.1.5e6.correlation <- cor.test(CARTKill5.1.5e6$Tumor.Control.5e6.Dose,
                                           CARTKill5.1.5e6$CART.Kill.5.1.E.T,
                                           method = "spearman")
CARTKill5.1.5e6.correlation.spearman <- CARTKill5.1.5e6.correlation$estimate
CARTKill5.1.5e6.correlation.pvalue <- CARTKill5.1.5e6.correlation$p.value
ggplotly(ggplot(data = CARTKill5.1.5e6, aes(x = CART.Kill.5.1.E.T, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto Cytotoxicity Assay at 5:1 E:T ratio") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 80, y = 15,
                    label = paste("Spearman =", round(CARTKill5.1.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTKill5.1.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Cytotoxicity 10:1 E:T ratio
```{r}
CARTKill10.1.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Kill.10.1.E.T) %>% 
  na.omit()
CARTKill10.1.5e6.correlation <- cor.test(CARTKill10.1.5e6$Tumor.Control.5e6.Dose,
                                           CARTKill10.1.5e6$CART.Kill.10.1.E.T,
                                           method = "spearman")
CARTKill10.1.5e6.correlation.spearman <- CARTKill10.1.5e6.correlation$estimate
CARTKill10.1.5e6.correlation.pvalue <- CARTKill10.1.5e6.correlation$p.value
ggplotly(ggplot(data = CARTKill10.1.5e6, aes(x = CART.Kill.10.1.E.T, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto Cytotoxicity Assay at 10:1 E:T ratio") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 80, y = 15,
                    label = paste("Spearman =", round(CARTKill10.1.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTKill10.1.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Luciferase Cytotoxicity EC:50
```{r}
CARTKillEC50.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Kill.EC50) %>% 
  na.omit()
CARTKillEC50.5e6.correlation <- cor.test(CARTKillEC50.5e6$Tumor.Control.5e6.Dose,
                                           CARTKillEC50.5e6$CART.Kill.EC50,
                                           method = "spearman")
CARTKillEC50.5e6.correlation.spearman <- CARTKillEC50.5e6.correlation$estimate
CARTKillEC50.5e6.correlation.pvalue <- CARTKillEC50.5e6.correlation$p.value
ggplotly(ggplot(data = CARTKillEC50.5e6, aes(x = CART.Kill.EC50, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto EC50 of Cytotoxicity Assay") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 7.5, y = 15,
                    label = paste("Spearman =", round(CARTKillEC50.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTKillEC50.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Serial Restim Cytotoxicity EC50
```{r}
CARTSerialRestimEC50.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.Serial.Restim.EC50) %>% 
  na.omit()
CARTSerialRestimEC50.5e6.correlation <- cor.test(CARTSerialRestimEC50.5e6$Tumor.Control.5e6.Dose,
                                           CARTSerialRestimEC50.5e6$CART.Serial.Restim.EC50,
                                           method = "spearman")
CARTSerialRestimEC50.5e6.correlation.spearman <- CARTSerialRestimEC50.5e6.correlation$estimate
CARTSerialRestimEC50.5e6.correlation.pvalue <- CARTSerialRestimEC50.5e6.correlation$p.value
ggplotly(ggplot(data = CARTSerialRestimEC50.5e6, aes(x = CART.Serial.Restim.EC50, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto EC50 of Serial Restimulation Assay") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 5, y = 15,
                    label = paste("Spearman =", round(CARTSerialRestimEC50.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTSerialRestimEC50.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

Row
----------------------------------------------------------------
### CD127 of CD4
```{r}
CD4CD127.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.CD4.CD127) %>% 
  na.omit()
CD4CD127.5e6.correlation <- cor.test(CD4CD127.5e6$Tumor.Control.5e6.Dose,
                                     CD4CD127.5e6$CART.CD4.CD127,
                                     method = "spearman")
CD4CD127.5e6.correlation.spearman <- CD4CD127.5e6.correlation$estimate
CD4CD127.5e6.correlation.pvalue <- CD4CD127.5e6.correlation$p.value
ggplotly(ggplot(data = CD4CD127.5e6, aes(x = CART.CD4.CD127, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto CD4-CD127 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 90, y = 15,
                    label = paste("Spearman =", round(CD4CD127.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD4CD127.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### CD127 of CD4
```{r}
CD8CD127.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.CD8.CD127) %>% 
  na.omit()
CD8CD127.5e6.correlation <- cor.test(CD8CD127.5e6$Tumor.Control.5e6.Dose,
                                     CD8CD127.5e6$CART.CD8.CD127,
                                     method = "spearman")
CD8CD127.5e6.correlation.spearman <- CD8CD127.5e6.correlation$estimate
CD8CD127.5e6.correlation.pvalue <- CD8CD127.5e6.correlation$p.value
ggplotly(ggplot(data = CD8CD127.5e6, aes(x = CART.CD8.CD127, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto CD8-CD127 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 80, y = 15,
                    label = paste("Spearman =", round(CD8CD127.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD8CD127.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Tscm of CD4
```{r}
CD4Tscm.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.CD4.Tscm) %>% 
  na.omit()
CD4Tscm.5e6.correlation <- cor.test(CD4Tscm.5e6$Tumor.Control.5e6.Dose,
                                     CD4Tscm.5e6$CART.CD4.Tscm,
                                     method = "spearman")
CD4Tscm.5e6.correlation.spearman <- CD4Tscm.5e6.correlation$estimate
CD4Tscm.5e6.correlation.pvalue <- CD4Tscm.5e6.correlation$p.value
ggplotly(ggplot(data = CD4Tscm.5e6, aes(x = CART.CD4.Tscm, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto CD4-Tscm of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 50, y = 15,
                    label = paste("Spearman =", round(CD4Tscm.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD4Tscm.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Tscm of CD8
```{r}
CD8Tscm.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.CD8.Tscm) %>% 
  na.omit()
CD8Tscm.5e6.correlation <- cor.test(CD8Tscm.5e6$Tumor.Control.5e6.Dose,
                                     CD8Tscm.5e6$CART.CD8.Tscm,
                                     method = "spearman")
CD8Tscm.5e6.correlation.spearman <- CD8Tscm.5e6.correlation$estimate
CD8Tscm.5e6.correlation.pvalue <- CD8Tscm.5e6.correlation$p.value
ggplotly(ggplot(data = CD8Tscm.5e6, aes(x = CART.CD8.Tscm, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto CD8-Tscm of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 60, y = 15,
                    label = paste("Spearman =", round(CD8Tscm.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD8Tscm.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

Row
------------------------------------------------------------------
### PD1 of CD4
```{r}
CD4PD1.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.CD4.PD1) %>% 
  na.omit()
CD4PD1.5e6.correlation <- cor.test(CD4PD1.5e6$Tumor.Control.5e6.Dose,
                                     CD4PD1.5e6$CART.CD4.PD1,
                                     method = "spearman")
CD4PD1.5e6.correlation.spearman <- CD4PD1.5e6.correlation$estimate
CD4PD1.5e6.correlation.pvalue <- CD4PD1.5e6.correlation$p.value
ggplotly(ggplot(data = CD4PD1.5e6, aes(x = CART.CD4.PD1, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto CD4-PD1 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 50, y = 15,
                    label = paste("Spearman =", round(CD4PD1.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD4PD1.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PD1 of CD8
```{r}
CD8PD1.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.CD8.PD1) %>% 
  na.omit()
CD8PD1.5e6.correlation <- cor.test(CD8PD1.5e6$Tumor.Control.5e6.Dose,
                                     CD8PD1.5e6$CART.CD8.PD1,
                                     method = "spearman")
CD8PD1.5e6.correlation.spearman <- CD8PD1.5e6.correlation$estimate
CD8PD1.5e6.correlation.pvalue <- CD8PD1.5e6.correlation$p.value
ggplotly(ggplot(data = CD8PD1.5e6, aes(x = CART.CD8.PD1, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto CD8-PD1 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 30, y = 15,
                    label = paste("Spearman =", round(CD8PD1.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD8PD1.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Tim3 of CD8
```{r}
CD8Tim3.5e6 <- InvitroSpearmansBarchart.5e6 %>% 
  select(Tumor.Control.5e6.Dose, CART.CD8.Tim3) %>% 
  na.omit()
CD8Tim3.5e6.correlation <- cor.test(CD8Tim3.5e6$Tumor.Control.5e6.Dose,
                                     CD8Tim3.5e6$CART.CD8.Tim3,
                                     method = "spearman")
CD8Tim3.5e6.correlation.spearman <- CD8Tim3.5e6.correlation$estimate
CD8Tim3.5e6.correlation.pvalue <- CD8Tim3.5e6.correlation$p.value
ggplotly(ggplot(data = CD8Tim3.5e6, aes(x = CART.CD8.Tim3, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose correlates\nto CD8-Tim3 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 25, y = 15,
                    label = paste("Spearman =", round(CD8Tim3.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD8Tim3.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```



In-Vitro Assays to 2.5e6 Dose {data-orientation=rows data-navmenu="Tumor Control Correlations" data-navmenu-icon="fa-chart-line" data-icon="fa-person-walking"}
==========================================================================
Rows
-------------------------------------------
### Tumor Control at 2.5e6 Dose Distribution
```{r fig.width=2}
TumorControl2.5e6.Histogram <- DonorScreenDatabase %>% 
  filter(!is.na(Tumor.Control.2.5e6.Dose))
tumorcontrol2.5e6_median <- median(TumorControl2.5e6.Histogram$Tumor.Control.2.5e6.Dose)
tumorcontrol2.5e6_mean <- mean(TumorControl2.5e6.Histogram$Tumor.Control.2.5e6.Dose)
tumorcontrol2.5e6.normality <- shapiro.test(TumorControl2.5e6.Histogram$Tumor.Control.2.5e6.Dose)

ggplotly(ggplot(data = TumorControl2.5e6.Histogram, aes(x=Tumor.Control.2.5e6.Dose)) +
           geom_histogram(fill="#FCD792", color="black", binwidth = 15) +
           geom_vline(xintercept = tumorcontrol2.5e6_median, color="#054B71", linetype="dashed", size=1) +
           annotate(geom="text", x=80, y=17, color="#054B71", size = 2.5,
                    label=paste("TumorControl\nMedian =", round(tumorcontrol2.5e6_median, 1))) +
           geom_vline(xintercept = tumorcontrol2.5e6_mean, color="#0086BD", linetype = "dashed", size=1) +
           annotate(geom="text", x=15, y=14, color="#0086BD", size=2.5,
                    label=paste("TumorControl\nMean =", round(tumorcontrol2.5e6_mean, 1))) +
           annotate(geom = "text", x=0, y=16, size=2.5,
                    label=paste("Shapiro-Wilk\nNormality Test =", format.pval(tumorcontrol2.5e6.normality$p.value, digits = 5))) +
           labs(x="%Tumor Control at 2.5e6 Dose", y="Frequency", 
                title="Tumor Control at 2.5e6 dose\nis not normally distributed") +
           theme(axis.title.x = element_text(size=10, face="bold"),
                 axis.title.y = element_text(size=10, face="bold"),
                 axis.text.x = element_text(size=10),
                 axis.text.y = element_text(size=10),
                 plot.title = element_text(size=10, face="bold")))
```

### In-Vitro Assays to 2.5e6 dose
```{r}
InvitroSpearmansBarchart.2.5e6 <- DonorScreenDatabase %>% 
  select(229:292, Tumor.Control.2.5e6.Dose, -"CART.Serial.Restim.EC50")
InvitroSpearmans <- rcorr(as.matrix(InvitroSpearmansBarchart.2.5e6), type = "spearman")
InvitroRho2.5e6 <- InvitroSpearmans$r["Tumor.Control.2.5e6.Dose", ]
InvitroPvalue2.5e6 <- InvitroSpearmans$P["Tumor.Control.2.5e6.Dose", ]
Invitro.Rho.Pvalue.Dataframe.2.5e6 <- data.frame(Rho = InvitroRho2.5e6, pvalue = InvitroPvalue2.5e6)
filtered.Rho.Pvalue.Dataframe.2.5e6 <- Invitro.Rho.Pvalue.Dataframe.2.5e6 %>% 
  filter(pvalue <= 0.01) %>% 
  na.omit()
ggplotly(ggplot(filtered.Rho.Pvalue.Dataframe.2.5e6, aes(x = Rho, y = reorder(row.names(filtered.Rho.Pvalue.Dataframe.2.5e6), Rho), fill = Rho)) +
           geom_bar(stat = "identity", color = "black") +
           geom_text(aes(label = round(Rho, 2)), position = position_stack(vjust = 0.6), size = 3) +
           scale_fill_gradient2(low = "#EF476F", mid = "white", high = "#0086BD", midpoint = 0, name = "Spearman Correlation") +
           labs(title = "Invitro Assay Correlations to Tumor Control at 2.5e6",
                x = "Spearman Correlation",
                y = "Variables") +
           theme(axis.text.y = element_text(size = 10),
                 axis.title.y = element_text(size=10, face="bold"),
                 plot.title = element_text(size = 10, face="bold"),
                 axis.title.x = element_text(size=10, face="bold"),
                 axis.text.x = element_text(size=10)) +
           annotate("text", x = 0.3, y = 1.1, label = "All values p<0.01", size = 2, color = "red"))
```

Rows
-----------------------------------------
### 0hrsPostthaw Luna
```{r}
Luna0hrs2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.Viable.Luna.postthaw.0hrs) %>% 
  na.omit()
Luna0hrs2.5e6.correlation <- cor.test(Luna0hrs2.5e6$Tumor.Control.2.5e6.Dose,
                                     Luna0hrs2.5e6$CART.Viable.Luna.postthaw.0hrs,
                                     method = "spearman")
Luna0hrs2.5e6.correlation.spearman <- Luna0hrs2.5e6.correlation$estimate
Luna0hrs2.5e6.correlation.pvalue <- Luna0hrs2.5e6.correlation$p.value
ggplotly(ggplot(data = Luna0hrs2.5e6, aes(x = CART.Viable.Luna.postthaw.0hrs, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto Luna viability 0hrs postthaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 70, y = 75,
                    label = paste("Spearman =", round(Luna0hrs2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Luna0hrs2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 24hrsPostthaw Luna
```{r}
Luna24hrs2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.Viable.Luna.postthaw.24hrs) %>% 
  na.omit()
Luna24hrs2.5e6.correlation <- cor.test(Luna24hrs2.5e6$Tumor.Control.2.5e6.Dose,
                                     Luna24hrs2.5e6$CART.Viable.Luna.postthaw.24hrs,
                                     method = "spearman")
Luna24hrs2.5e6.correlation.spearman <- Luna24hrs2.5e6.correlation$estimate
Luna24hrs2.5e6.correlation.pvalue <- Luna24hrs2.5e6.correlation$p.value
ggplotly(ggplot(data = Luna24hrs2.5e6, aes(x = CART.Viable.Luna.postthaw.24hrs, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto Luna viability 24hrs postthaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 50, y = 75,
                    label = paste("Spearman =", round(Luna24hrs2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Luna24hrs2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 48hrsPostthaw Luna
```{r}
Luna48hrs2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.Viable.Luna.postthaw.48hrs) %>% 
  na.omit()
Luna48hrs2.5e6.correlation <- cor.test(Luna48hrs2.5e6$Tumor.Control.2.5e6.Dose,
                                     Luna48hrs2.5e6$CART.Viable.Luna.postthaw.48hrs,
                                     method = "spearman")
Luna48hrs2.5e6.correlation.spearman <- Luna48hrs2.5e6.correlation$estimate
Luna48hrs2.5e6.correlation.pvalue <- Luna48hrs2.5e6.correlation$p.value
ggplotly(ggplot(data = Luna48hrs2.5e6, aes(x = CART.Viable.Luna.postthaw.48hrs, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto Luna viability 48hrs postthaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 80, y = -25,
                    label = paste("Spearman =", round(Luna48hrs2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Luna48hrs2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 24hrPostThaw AV/PI
```{r}
Healthy24hrs2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.Healthy.postthaw.24hrs) %>% 
  na.omit()
Healthy24hrs2.5e6.correlation <- cor.test(Healthy24hrs2.5e6$Tumor.Control.2.5e6.Dose,
                                        Healthy24hrs2.5e6$CART.Healthy.postthaw.24hrs,
                                        method = "spearman")
Healthy24hrs2.5e6.correlation.spearman <- Healthy24hrs2.5e6.correlation$estimate
Healthy24hrs2.5e6.correlation.pvalue <- Healthy24hrs2.5e6.correlation$p.value
ggplotly(ggplot(data = Healthy24hrs2.5e6, aes(x = CART.Healthy.postthaw.24hrs, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose\ncorrelates to Non-Apoptotic CAR-Ts 24hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 40, y = -25,
                    label = paste("Spearman =", round(Healthy24hrs2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Healthy24hrs2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))

```

Rows
-----------------------------------------------------
### 0hrsPostThaw LateApoptotic
```{r}
LateApoptotic.0hrs.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.LateApoptotic.postthaw.0hrs) %>% 
  na.omit()
LateApoptotic.0hrs.2.5e6.correlation <- cor.test(LateApoptotic.0hrs.2.5e6$Tumor.Control.2.5e6.Dose,
                                        LateApoptotic.0hrs.2.5e6$CART.LateApoptotic.postthaw.0hrs,
                                        method = "spearman")
LateApoptotic.0hrs.2.5e6.correlation.spearman <- LateApoptotic.0hrs.2.5e6.correlation$estimate
LateApoptotic.0hrs.2.5e6.correlation.pvalue <- LateApoptotic.0hrs.2.5e6.correlation$p.value
ggplotly(ggplot(data = LateApoptotic.0hrs.2.5e6, aes(x = CART.LateApoptotic.postthaw.0hrs, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CAR-T Late Apoptotic 0hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 20, y = 75,
                    label = paste("Spearman =", round(LateApoptotic.0hrs.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(LateApoptotic.0hrs.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 24hrsPostThaw LateApoptotic
```{r}
LateApoptotic.24hrs.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.LateApoptotic.postthaw.24hrs) %>% 
  na.omit()
LateApoptotic.24hrs.2.5e6.correlation <- cor.test(LateApoptotic.24hrs.2.5e6$Tumor.Control.2.5e6.Dose,
                                        LateApoptotic.24hrs.2.5e6$CART.LateApoptotic.postthaw.24hrs,
                                        method = "spearman")
LateApoptotic.24hrs.2.5e6.correlation.spearman <- LateApoptotic.24hrs.2.5e6.correlation$estimate
LateApoptotic.24hrs.2.5e6.correlation.pvalue <- LateApoptotic.24hrs.2.5e6.correlation$p.value
ggplotly(ggplot(data = LateApoptotic.24hrs.2.5e6, aes(x = CART.LateApoptotic.postthaw.24hrs, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CAR-T Late Apoptotic 24hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 60, y = 75,
                    label = paste("Spearman =", round(LateApoptotic.24hrs.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(LateApoptotic.24hrs.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 48hrsPostThaw Necrotic
```{r}
Necrotic.48hrs.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.Necrotic.postthaw.48hrs) %>% 
  na.omit()
Necrotic.48hrs.2.5e6.correlation <- cor.test(Necrotic.48hrs.2.5e6$Tumor.Control.2.5e6.Dose,
                                        Necrotic.48hrs.2.5e6$CART.Necrotic.postthaw.48hrs,
                                        method = "spearman")
Necrotic.48hrs.2.5e6.correlation.spearman <- Necrotic.48hrs.2.5e6.correlation$estimate
Necrotic.48hrs.2.5e6.correlation.pvalue <- Necrotic.48hrs.2.5e6.correlation$p.value
ggplotly(ggplot(data = Necrotic.48hrs.2.5e6, aes(x = CART.Necrotic.postthaw.48hrs, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose\ncorrelates to CAR-T Necrotic 48hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 2.5, y = -25,
                    label = paste("Spearman =", round(Necrotic.48hrs.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(Necrotic.48hrs.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 48hrsPostThaw Early Apoptotic
```{r}
EarlyApoptotic.48hrs.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.EarlyApoptotic.postthaw.48hrs) %>% 
  na.omit()
EarlyApoptotic.48hrs.2.5e6.correlation <- cor.test(EarlyApoptotic.48hrs.2.5e6$Tumor.Control.2.5e6.Dose,
                                        EarlyApoptotic.48hrs.2.5e6$CART.EarlyApoptotic.postthaw.48hrs,
                                        method = "spearman")
EarlyApoptotic.48hrs.2.5e6.correlation.spearman <- EarlyApoptotic.48hrs.2.5e6.correlation$estimate
EarlyApoptotic.48hrs.2.5e6.correlation.pvalue <- EarlyApoptotic.48hrs.2.5e6.correlation$p.value
ggplotly(ggplot(data = EarlyApoptotic.48hrs.2.5e6, aes(x = CART.EarlyApoptotic.postthaw.48hrs, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CAR-T Early Apoptotic 48hrs post-thaw") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 10, y = 15,
                    label = paste("Spearman =", round(EarlyApoptotic.48hrs.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(EarlyApoptotic.48hrs.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```


Rows
----------------------------------------------------
### Cytotoxicity 5:1 E:T ratio
```{r}
CARTKill5.1.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.Kill.5.1.E.T) %>% 
  na.omit()
CARTKill5.1.2.5e6.correlation <- cor.test(CARTKill5.1.2.5e6$Tumor.Control.2.5e6.Dose,
                                           CARTKill5.1.2.5e6$CART.Kill.5.1.E.T,
                                           method = "spearman")
CARTKill5.1.2.5e6.correlation.spearman <- CARTKill5.1.2.5e6.correlation$estimate
CARTKill5.1.2.5e6.correlation.pvalue <- CARTKill5.1.2.5e6.correlation$p.value
ggplotly(ggplot(data = CARTKill5.1.2.5e6, aes(x = CART.Kill.5.1.E.T, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto Cytotoxicity Assay at 5:1 E:T ratio") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 40, y = 50,
                    label = paste("Spearman =", round(CARTKill5.1.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTKill5.1.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Cytotoxicity 10:1 E:T ratio
```{r}
CARTKill10.1.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.Kill.10.1.E.T) %>% 
  na.omit()
CARTKill10.1.2.5e6.correlation <- cor.test(CARTKill10.1.2.5e6$Tumor.Control.2.5e6.Dose,
                                           CARTKill10.1.2.5e6$CART.Kill.10.1.E.T,
                                           method = "spearman")
CARTKill10.1.2.5e6.correlation.spearman <- CARTKill10.1.2.5e6.correlation$estimate
CARTKill10.1.2.5e6.correlation.pvalue <- CARTKill10.1.2.5e6.correlation$p.value
ggplotly(ggplot(data = CARTKill10.1.2.5e6, aes(x = CART.Kill.10.1.E.T, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto Cytotoxicity Assay at 10:1 E:T ratio") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 40, y = 50,
                    label = paste("Spearman =", round(CARTKill10.1.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTKill10.1.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Luciferase Cytotoxicity EC:50
```{r}
CARTKillEC50.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.Kill.EC50) %>% 
  na.omit()
CARTKillEC50.2.5e6.correlation <- cor.test(CARTKillEC50.2.5e6$Tumor.Control.2.5e6.Dose,
                                           CARTKillEC50.2.5e6$CART.Kill.EC50,
                                           method = "spearman")
CARTKillEC50.2.5e6.correlation.spearman <- CARTKillEC50.2.5e6.correlation$estimate
CARTKillEC50.2.5e6.correlation.pvalue <- CARTKillEC50.2.5e6.correlation$p.value
ggplotly(ggplot(data = CARTKillEC50.2.5e6, aes(x = CART.Kill.EC50, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto EC50 of Cytotoxicity Assay") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 20, y = 90,
                    label = paste("Spearman =", round(CARTKillEC50.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTKillEC50.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

Row
-------------------------------------------
### CD127 of CD4
```{r}
CD4CD127.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD4.CD127) %>% 
  na.omit()
CD4CD127.2.5e6.correlation <- cor.test(CD4CD127.2.5e6$Tumor.Control.2.5e6.Dose,
                                     CD4CD127.2.5e6$CART.CD4.CD127,
                                     method = "spearman")
CD4CD127.2.5e6.correlation.spearman <- CD4CD127.2.5e6.correlation$estimate
CD4CD127.2.5e6.correlation.pvalue <- CD4CD127.2.5e6.correlation$p.value
ggplotly(ggplot(data = CD4CD127.2.5e6, aes(x = CART.CD4.CD127, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CD4-CD127 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 60, y = 90,
                    label = paste("Spearman =", round(CD4CD127.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD4CD127.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### CD127 of CD8
```{r}
CD8CD127.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD8.CD127) %>% 
  na.omit()
CD8CD127.2.5e6.correlation <- cor.test(CD8CD127.2.5e6$Tumor.Control.2.5e6.Dose,
                                     CD8CD127.2.5e6$CART.CD8.CD127,
                                     method = "spearman")
CD8CD127.2.5e6.correlation.spearman <- CD8CD127.2.5e6.correlation$estimate
CD8CD127.2.5e6.correlation.pvalue <- CD8CD127.2.5e6.correlation$p.value
ggplotly(ggplot(data = CD8CD127.2.5e6, aes(x = CART.CD8.CD127, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CD8-CD127 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 75, y = -25,
                    label = paste("Spearman =", round(CD8CD127.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD8CD127.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Tscm of CD4
```{r}
CD4Tscm.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD4.Tscm) %>% 
  na.omit()
CD4Tscm.2.5e6.correlation <- cor.test(CD4Tscm.2.5e6$Tumor.Control.2.5e6.Dose,
                                     CD4Tscm.2.5e6$CART.CD4.Tscm,
                                     method = "spearman")
CD4Tscm.2.5e6.correlation.spearman <- CD4Tscm.2.5e6.correlation$estimate
CD4Tscm.2.5e6.correlation.pvalue <- CD4Tscm.2.5e6.correlation$p.value
ggplotly(ggplot(data = CD4Tscm.2.5e6, aes(x = CART.CD4.Tscm, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CD4-Tscm of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 50, y = -25,
                    label = paste("Spearman =", round(CD4Tscm.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD4Tscm.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Tscm of CD8
```{r}
CD8Tscm.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD8.Tscm) %>% 
  na.omit()
CD8Tscm.2.5e6.correlation <- cor.test(CD8Tscm.2.5e6$Tumor.Control.2.5e6.Dose,
                                     CD8Tscm.2.5e6$CART.CD8.Tscm,
                                     method = "spearman")
CD8Tscm.2.5e6.correlation.spearman <- CD8Tscm.2.5e6.correlation$estimate
CD8Tscm.2.5e6.correlation.pvalue <- CD8Tscm.2.5e6.correlation$p.value
ggplotly(ggplot(data = CD8Tscm.2.5e6, aes(x = CART.CD8.Tscm, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CD8-Tscm of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 60, y = -25,
                    label = paste("Spearman =", round(CD8Tscm.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD8Tscm.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

Row
-------------------------------------------------------------------
### PD1 of CD4
```{r}
CD4PD1.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD4.PD1) %>% 
  na.omit()
CD4PD1.2.5e6.correlation <- cor.test(CD4PD1.2.5e6$Tumor.Control.2.5e6.Dose,
                                     CD4PD1.2.5e6$CART.CD4.PD1,
                                     method = "spearman")
CD4PD1.2.5e6.correlation.spearman <- CD4PD1.2.5e6.correlation$estimate
CD4PD1.2.5e6.correlation.pvalue <- CD4PD1.2.5e6.correlation$p.value
ggplotly(ggplot(data = CD4PD1.2.5e6, aes(x = CART.CD4.PD1, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CD4-PD1 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 25, y = 15,
                    label = paste("Spearman =", round(CD4PD1.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD4PD1.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### PD1 of CD8
```{r}
CD8PD1.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD8.PD1) %>% 
  na.omit()
CD8PD1.2.5e6.correlation <- cor.test(CD8PD1.2.5e6$Tumor.Control.2.5e6.Dose,
                                     CD8PD1.2.5e6$CART.CD8.PD1,
                                     method = "spearman")
CD8PD1.2.5e6.correlation.spearman <- CD8PD1.2.5e6.correlation$estimate
CD8PD1.2.5e6.correlation.pvalue <- CD8PD1.2.5e6.correlation$p.value
ggplotly(ggplot(data = CD8PD1.2.5e6, aes(x = CART.CD8.PD1, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CD8-PD1 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 10, y = -10,
                    label = paste("Spearman =", round(CD8PD1.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD8PD1.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Lag3 of CD4
```{r}
CD4Lag3.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD4.Lag3) %>% 
  na.omit()
CD4Lag3.2.5e6.correlation <- cor.test(CD4Lag3.2.5e6$Tumor.Control.2.5e6.Dose,
                                     CD4Lag3.2.5e6$CART.CD4.Lag3,
                                     method = "spearman")
CD4Lag3.2.5e6.correlation.spearman <- CD4Lag3.2.5e6.correlation$estimate
CD4Lag3.2.5e6.correlation.pvalue <- CD4Lag3.2.5e6.correlation$p.value
ggplotly(ggplot(data = CD4Lag3.2.5e6, aes(x = CART.CD4.Lag3, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CD4-Lag3 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 20, y = -25,
                    label = paste("Spearman =", round(CD4Lag3.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD4Lag3.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### Lag3 of CD8
```{r}
CD8Lag3.2.5e6 <- InvitroSpearmansBarchart.2.5e6 %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD8.Lag3) %>% 
  na.omit()
CD8Lag3.2.5e6.correlation <- cor.test(CD8Lag3.2.5e6$Tumor.Control.2.5e6.Dose,
                                     CD8Lag3.2.5e6$CART.CD8.Lag3,
                                     method = "spearman")
CD8Lag3.2.5e6.correlation.spearman <- CD8Lag3.2.5e6.correlation$estimate
CD8Lag3.2.5e6.correlation.pvalue <- CD8Lag3.2.5e6.correlation$p.value
ggplotly(ggplot(data = CD8Lag3.2.5e6, aes(x = CART.CD8.Lag3, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose correlates\nto CD8-Lag3 of CAR-Ts") +
           theme(plot.title = element_text(size = 10, face = "bold"),
                 axis.title = element_text(size = 10, face = "bold"),
                 axis.text = element_text(size = 10),
                 legend.position = "right") +
           annotate("text", x = 20, y = -25,
                    label = paste("Spearman =", round(CD8Lag3.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CD8Lag3.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```


CD4-CD8 focus {data-orientation=rows data-navmenu="Tumor Control Correlations" data-navmenu-icon="fa-chart-line" data-icon="fa-person-walking"}
==========================================================================
Row
-------------------------------------
###
```{r}
InvitroSpearmans.mixed <- DonorScreenDatabase %>%
  mutate(Tumor.Control.mixed.dose = if_else(!is.na(Tumor.Control.2.5e6.Dose),
                                            Tumor.Control.2.5e6.Dose,
                                            Tumor.Control.5e6.Dose,
                                            missing = NA_real_)) %>% 
  mutate(CART.CD4.CD8.ratio = CART.CD4 / CART.CD8) %>% 
  select(CART.CD4, CART.CD8, CART.CD4.CD8.ratio, Tumor.Control.mixed.dose, Tumor.Control.5e6.Dose, Tumor.Control.2.5e6.Dose)
CARTCD4.5e6 <- InvitroSpearmans.mixed %>% 
  select(Tumor.Control.5e6.Dose, CART.CD4) %>% 
  na.omit()
CARTCD4.5e6.correlation <- cor.test(CARTCD4.5e6$Tumor.Control.5e6.Dose,
                                    CARTCD4.5e6$CART.CD4,
                                    method = "spearman")
CARTCD4.5e6.correlation.spearman <- CARTCD4.5e6.correlation$estimate
CARTCD4.5e6.correlation.pvalue <- CARTCD4.5e6.correlation$p.value
ggplotly(ggplot(data = CARTCD4.5e6, aes(x = CART.CD4, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose\nvs %CD4 of CAR-T",
                x="%CD4 of CAR-T",
                y="Tumor Control at 5e6 dose") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 70, y = 30,
                    label = paste("Spearman =", round(CARTCD4.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTCD4.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

### 
```{r}
CARTCD8.5e6 <- InvitroSpearmans.mixed %>% 
  select(Tumor.Control.5e6.Dose, CART.CD8) %>% 
  na.omit()
CARTCD8.5e6.correlation <- cor.test(CARTCD8.5e6$Tumor.Control.5e6.Dose,
                                    CARTCD8.5e6$CART.CD8,
                                    method = "spearman")
CARTCD8.5e6.correlation.spearman <- CARTCD8.5e6.correlation$estimate
CARTCD8.5e6.correlation.pvalue <- CARTCD8.5e6.correlation$p.value
ggplotly(ggplot(data = CARTCD8.5e6, aes(x = CART.CD8, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose\nvs %CD8 of CAR-T",
                x="%CD8 of CAR-T",
                y="Tumor Control at 5e6 dose") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 29, y = 15,
                    label = paste("Spearman =", round(CARTCD8.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTCD8.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

###
```{r}
CARTCD4CD8ratio.5e6 <- InvitroSpearmans.mixed %>% 
  select(Tumor.Control.5e6.Dose, CART.CD4.CD8.ratio) %>% 
  na.omit()
CARTCD4CD8ratio.5e6.correlation <- cor.test(CARTCD4CD8ratio.5e6$Tumor.Control.5e6.Dose,
                                            CARTCD4CD8ratio.5e6$CART.CD4.CD8.ratio,
                                            method = "spearman")
CARTCD4CD8ratio.5e6.correlation.spearman <- CARTCD4CD8ratio.5e6.correlation$estimate
CARTCD4CD8ratio.5e6.correlation.pvalue <- CARTCD4CD8ratio.5e6.correlation$p.value
ggplotly(ggplot(data = CARTCD4CD8ratio.5e6, aes(x = CART.CD4.CD8.ratio, y = Tumor.Control.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 5e6 dose\nvs CD4/CD8 ratio of CAR-T",
                x="CD4/CD8 ratio of CAR-T",
                y="Tumor Control at 5e6 dose") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 3, y = 15,
                    label = paste("Spearman =", round(CARTCD4CD8ratio.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTCD4CD8ratio.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

Row
-----------------------------------------
###
```{r}
CARTCD4.2.5e6 <- InvitroSpearmans.mixed %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD4) %>% 
  na.omit()
CARTCD4.2.5e6.correlation <- cor.test(CARTCD4.2.5e6$Tumor.Control.2.5e6.Dose,
                                    CARTCD4.2.5e6$CART.CD4,
                                    method = "spearman")
CARTCD4.2.5e6.correlation.spearman <- CARTCD4.2.5e6.correlation$estimate
CARTCD4.2.5e6.correlation.pvalue <- CARTCD4.2.5e6.correlation$p.value
ggplotly(ggplot(data = CARTCD4.2.5e6, aes(x = CART.CD4, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose\nvs %CD4 of CAR-T",
                x="%CD4 of CAR-T",
                y="Tumor Control at 2.5e6 dose") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 60, y = -40,
                    label = paste("Spearman =", round(CARTCD4.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTCD4.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

###
```{r}
CARTCD8.2.5e6 <- InvitroSpearmans.mixed %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD8) %>% 
  na.omit()
CARTCD8.2.5e6.correlation <- cor.test(CARTCD8.2.5e6$Tumor.Control.2.5e6.Dose,
                                    CARTCD8.2.5e6$CART.CD8,
                                    method = "spearman")
CARTCD8.2.5e6.correlation.spearman <- CARTCD8.2.5e6.correlation$estimate
CARTCD8.2.5e6.correlation.pvalue <- CARTCD8.2.5e6.correlation$p.value
ggplotly(ggplot(data = CARTCD8.2.5e6, aes(x = CART.CD8, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6 dose\nvs %CD8 of CAR-T",
                x="%CD8 of CAR-T",
                y="Tumor Control at 2.5e6 dose") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 40, y = -40,
                    label = paste("Spearman =", round(CARTCD8.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTCD8.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

###
```{r}
CARTCD4CD8ratio.2.5e6 <- InvitroSpearmans.mixed %>% 
  select(Tumor.Control.2.5e6.Dose, CART.CD4.CD8.ratio) %>% 
  na.omit()
CARTCD4CD8ratio.2.5e6.correlation <- cor.test(CARTCD4CD8ratio.2.5e6$Tumor.Control.2.5e6.Dose,
                                            CARTCD4CD8ratio.2.5e6$CART.CD4.CD8.ratio,
                                            method = "spearman")
CARTCD4CD8ratio.2.5e6.correlation.spearman <- CARTCD4CD8ratio.2.5e6.correlation$estimate
CARTCD4CD8ratio.2.5e6.correlation.pvalue <- CARTCD4CD8ratio.2.5e6.correlation$p.value
ggplotly(ggplot(data = CARTCD4CD8ratio.2.5e6, aes(x = CART.CD4.CD8.ratio, y = Tumor.Control.2.5e6.Dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at 2.5e6\nvs CD4/CD8 ratio of CAR-T",
                x="CD4/CD8 ratio of CAR-T",
                y="Tumor Control at 2.5e6 dose") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 2.5, y = -40,
                    label = paste("Spearman =", round(CARTCD4CD8ratio.2.5e6.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTCD4CD8ratio.2.5e6.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

Row
-------------------------------------------------
###
```{r}
CARTCD4.mixed.dose <- InvitroSpearmans.mixed %>% 
  select(Tumor.Control.mixed.dose, CART.CD4) %>% 
  na.omit()
View(CARTCD4.mixed.dose)
CARTCD4.mixed.dose.correlation <- cor.test(CARTCD4.mixed.dose$Tumor.Control.mixed.dose,
                                      CARTCD4.mixed.dose$CART.CD4,
                                      method = "spearman")
CARTCD4.mixed.dose.correlation.spearman <- CARTCD4.mixed.dose.correlation$estimate
CARTCD4.mixed.dose.correlation.pvalue <- CARTCD4.mixed.dose.correlation$p.value
ggplotly(ggplot(data = CARTCD4.mixed.dose, aes(x = CART.CD4, y = Tumor.Control.mixed.dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at mixed dose\nvs %CD4 of CAR-T",
                x="%CD4 of CAR-T",
                y="Tumor control at 2.5e6 dose and\n(if missing) 5e6 dose") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 70, y = -25,
                    label = paste("Spearman =", round(CARTCD4.mixed.dose.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTCD4.mixed.dose.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

###
```{r}
CARTCD8.mixed.dose <- InvitroSpearmans.mixed %>% 
  select(Tumor.Control.mixed.dose, CART.CD8) %>% 
  na.omit()
CARTCD8.mixed.dose.correlation <- cor.test(CARTCD8.mixed.dose$Tumor.Control.mixed.dose,
                                           CARTCD8.mixed.dose$CART.CD8,
                                           method = "spearman")
CARTCD8.mixed.dose.correlation.spearman <- CARTCD8.mixed.dose.correlation$estimate
CARTCD8.mixed.dose.correlation.pvalue <- CARTCD8.mixed.dose.correlation$p.value
ggplotly(ggplot(data = CARTCD8.mixed.dose, aes(x = CART.CD8, y = Tumor.Control.mixed.dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at mixed dose\nvs %CD8 of CAR-T",
                x="%CD8 of CAR-T",
                y="Tumor Control at 2.5e6 dose and\n(if missing) 5e6 dose") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 30, y = -25,
                    label = paste("Spearman =", round(CARTCD8.mixed.dose.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTCD8.mixed.dose.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```

###
```{r}
CARTCD4CD8.mixed.dose <- InvitroSpearmans.mixed %>% 
  select(Tumor.Control.mixed.dose, CART.CD4.CD8.ratio) %>% 
  na.omit()
CARTCD4CD8.mixed.dose.correlation <- cor.test(CARTCD4CD8.mixed.dose$Tumor.Control.mixed.dose,
                                           CARTCD4CD8.mixed.dose$CART.CD4.CD8.ratio,
                                           method = "spearman")
CARTCD4CD8.mixed.dose.correlation.spearman <- CARTCD4CD8.mixed.dose.correlation$estimate
CARTCD4CD8.mixed.dose.correlation.pvalue <- CARTCD4CD8.mixed.dose.correlation$p.value
ggplotly(ggplot(data = CARTCD4CD8.mixed.dose, aes(x = CART.CD4.CD8.ratio, y = Tumor.Control.mixed.dose)) +
           geom_point(size = 1.5) +
           geom_smooth(method = "lm") +
           labs(title = "Tumor Control at mixed dose\nvs CD4/CD8 ratio of CAR-T",
                x="CD4/CD8 ratio of CAR-T",
                y="Tumor Control at 2.5e6 dose and\n(if missing) 5e6 dose") +
           theme(plot.title = element_text(size = 12, face = "bold"),
                 axis.title = element_text(size = 7.5, face = "bold"),
                 axis.text = element_text(size = 7.5),
                 legend.position = "right") +
           annotate("text", x = 3, y = -25,
                    label = paste("Spearman =", round(CARTCD4CD8.mixed.dose.correlation.spearman, 2),
                                  "\np-value =", format.pval(CARTCD4CD8.mixed.dose.correlation.pvalue, digits = 10)),
                    color = "blue", fontface = "italic"))
```


